<!doctype html>
<html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>How to Setup Data Platform Infrastructure on Google Cloud Platform with Terraform</title><base href="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/"><script><!-- inlined for all pages -->
(()=>{var p=Object.defineProperty;var u=(c,t,e)=>t in c?p(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var s=(c,t,e)=>u(c,typeof t!="symbol"?t+"":t,e);var r=class r extends HTMLElement{constructor(){super(),this.ready=new Promise(t=>{this.readyResolve=t})}static getParents(t,e=!1){let a=[];for(;t;){if(t.matches&&t.matches(r.tagName)){if(e&&t===e)break;d.hasConditions(t)&&a.push(t)}t=t.parentNode}return a}static async ready(t,e){if(e||(e=r.getParents(t)),e.length===0)return;let a=await Promise.all(e.map(i=>i.wait()));if(a.length)return a[0]}forceFallback(){window.Island&&Object.assign(r.fallback,window.Island.fallback);for(let t in r.fallback){let e=Array.from(this.querySelectorAll(t)).reverse();for(let a of e){if(!a.isConnected)continue;let i=r.getParents(a);if(i.length===1){let o=r.ready(a,i);r.fallback[t](o,a,r.prefix)}}}}wait(){return this.ready}async connectedCallback(){d.hasConditions(this)&&this.forceFallback(),await this.hydrate()}getTemplates(){return this.querySelectorAll(`template[${r.attr.template}]`)}replaceTemplates(t){for(let e of t){if(r.getParents(e,this).length>0)continue;let a=e.getAttribute(r.attr.template);if(a==="replace"){let i=Array.from(this.childNodes);for(let o of i)this.removeChild(o);this.appendChild(e.content);break}else{let i=e.innerHTML;if(a==="once"&&i){if(r.onceCache.has(i)){e.remove();return}r.onceCache.set(i,!0)}e.replaceWith(e.content)}}}async hydrate(){let t=[];this.parentNode&&t.push(r.ready(this.parentNode));let e=d.getConditions(this);for(let a in e)d.map[a]&&t.push(d.map[a](e[a],this));await Promise.all(t),this.replaceTemplates(this.getTemplates());for(let a of r.onReady.values())await a.call(this,r);this.readyResolve(),this.setAttribute(r.attr.ready,""),this.querySelectorAll(`[${r.attr.defer}]`).forEach(a=>a.removeAttribute(r.attr.defer))}};s(r,"tagName","is-land"),s(r,"prefix","is-land--"),s(r,"attr",{template:"data-island",ready:"ready",defer:"defer-hydration"}),s(r,"onceCache",new Map),s(r,"onReady",new Map),s(r,"fallback",{":not(is-land,:defined,[defer-hydration])":(t,e,a)=>{let i=document.createElement(a+e.localName);for(let n of e.getAttributeNames())i.setAttribute(n,e.getAttribute(n));let o=e.shadowRoot;if(!o){let n=e.querySelector(":scope > template:is([shadowrootmode], [shadowroot])");if(n){let m=n.getAttribute("shadowrootmode")||n.getAttribute("shadowroot")||"closed";o=e.attachShadow({mode:m}),o.appendChild(n.content.cloneNode(!0))}}return o&&i.attachShadow({mode:o.mode}).append(...o.childNodes),i.append(...e.childNodes),e.replaceWith(i),t.then(()=>{i.shadowRoot&&e.shadowRoot.append(...i.shadowRoot.childNodes),e.append(...i.childNodes),i.replaceWith(e)})}});var f=r,l=class l{static hasConditions(t){return Object.keys(l.getConditions(t)).length>0}static getConditions(t){let e={};for(let a of Object.keys(l.map))t.hasAttribute(`on:${a}`)&&(e[a]=t.getAttribute(`on:${a}`));return e}static visible(t,e){if("IntersectionObserver"in window)return new Promise(a=>{let i=new IntersectionObserver(o=>{let[n]=o;n.isIntersecting&&(i.unobserve(n.target),a())});i.observe(e)})}static idle(){let t=new Promise(e=>{document.readyState!=="complete"?window.addEventListener("load",()=>e(),{once:!0}):e()});return"requestIdleCallback"in window?Promise.all([new Promise(e=>{requestIdleCallback(()=>{e()})}),t]):t}static interaction(t,e){let a=["click","touchstart"];return t&&(a=(t||"").split(",").map(i=>i.trim())),new Promise(i=>{function o(n){i();for(let m of a)e.removeEventListener(m,o)}for(let n of a)e.addEventListener(n,o,{once:!0})})}static media(t){let e={matches:!0};if(t&&"matchMedia"in window&&(e=window.matchMedia(t)),!e.matches)return new Promise(a=>{e.addListener(i=>{i.matches&&a()})})}static saveData(t){if(!(!("connection"in navigator)||navigator.connection.saveData===(t!=="false")))return new Promise(()=>{})}};s(l,"map",{visible:l.visible,idle:l.idle,interaction:l.interaction,media:l.media,"save-data":l.saveData});var d=l;"customElements"in window&&(window.customElements.define(f.tagName,f),window.Island=f);var y=f.ready;var h=class{};s(h,"attr",{autoInitType:"autoinit",import:"import"}),s(h,"types",{"petite-vue":function(t){t.createApp().mount(this)},vue:function(t){t.createApp().mount(this)},svelte:function(t){new t.default({target:this})},"svelte-ssr":function(t){new t.default({target:this,hydrate:!0})},preact:function(t){t.default(this)}});Island.onReady.set("import-autoinit",async function(c){let t,e=this.getAttribute(h.attr.import);if(e&&(t=await import(e)),t){let a=h.types[this.getAttribute(h.attr.autoInitType)||e];a&&await a.call(this,t)}});})();

(()=>{var a="theme-preference",l={dark:"#f5f5f6",light:"#262627"},t={value:d()};window.onload=()=>{let e=document.querySelector("#light-theme-toggle"),r=document.querySelector("#dark-theme-toggle");document.querySelector("[data-theme-switcher]")&&(c(),o(),e.addEventListener("click",()=>n("light")),r.addEventListener("click",()=>n("dark")),e.setAttribute("aria-pressed",t.value==="light"),r.setAttribute("aria-pressed",t.value==="dark"))};window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:e})=>{t.value=e?"dark":"light",i(),o()});function n(e){t.value=e,document.querySelector("#light-theme-toggle").setAttribute("aria-pressed",e==="light"),document.querySelector("#dark-theme-toggle").setAttribute("aria-pressed",e==="dark"),i(),o()}function d(){return localStorage.getItem(a)?localStorage.getItem(a):window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function i(){localStorage.setItem(a,t.value),c(),o()}function c(){document.firstElementChild.setAttribute("data-theme",t.value)}function o(){let e=document.querySelector('meta[name="theme-color"]'),r=t.value==="dark"?l.dark:l.light;e.setAttribute("content",r)}c();})();</script><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "http://localhost:8080#website",
        "url": "http://localhost:8080",
        "name": "The Scalable Way",
        "description": "Empowering Data Platforms with Precision and Scale",
        "inLanguage": "en_EN"
      }
    ]
  }</script><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": {
      "@type": "WebPage"
    },
    "isPartOf": {
      "@id": "http://localhost:8080#website"
    },
    "@id": "",
    "headline": "How to Setup Data Platform Infrastructure on Google Cloud Platform with Terraform",
    "description": "Learn how to set up a secure, scalable data platform infrastructure on Google Cloud Platform (GCP) using Terraform. This step-by-step guide covers VPC configuration, Compute Engine setup, firewall rules, Identity-Aware Proxy (IAP), Cloud NAT, and more, ensuring a cost-effective, flexible, and secure foundation for your data platform.",
    "image": "http://localhost:8080/assets/images/template/opengraph-default.jpg",
    "inLanguage": "en_EN",
    "publisher": {
      "@type": "Organization",
      "name": "The Scalable Way",
      "url": "http://localhost:8080"
    },
    "author": {
      "@type": "Person",
      "name": "The Scalable Way"
    },
    "datePublished": "2025-03-05T13:31:00.000Z"
  }</script><style>@layer tailwindBase{.transform{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1}.filter{--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: }}@layer reset{*,:after,:before{box-sizing:border-box}p{text-wrap:pretty}html:focus-within{scroll-behavior:smooth}body{line-height:1.5;min-height:100vh;min-height:100dvh;text-rendering:optimizeSpeed}blockquote,body,dd,dl,figure,h1,h2,h3,h4,p{margin:0}ol[role=list],ul[role=list],ul[role=tablist]{list-style:none}[role=list]{padding:0}a:not([class]){-webkit-text-decoration-skip:ink;text-decoration-skip-ink:auto}canvas,img,picture,svg{background-repeat:no-repeat;background-size:cover;block-size:auto;font-style:italic;max-inline-size:100%;shape-margin:.75rem;vertical-align:middle}picture{display:block}button{all:unset}button,input,select,textarea{color:inherit;font:inherit}textarea{resize:vertical;resize:block}textarea:not([rows]){min-height:10em}[role=button],[role=option],button,label,select,summary{cursor:pointer}:target{scroll-margin-block-start:2ex}:focus{scroll-margin-block-end:8vh}dialog{max-height:unset;max-width:unset}[popover],dialog{background:none;border:none;inset:unset}[popover]{color:inherit}[popover]:not(:popover-open),dialog:not([open],[popover]){display:none!important}html:has(dialog[open]:modal){overflow:hidden}@media (prefers-reduced-motion:reduce){html:focus-within{scroll-behavior:auto}*,:after,:before{animation-duration:.01ms!important;animation-iteration-count:1!important;scroll-behavior:auto!important;transition-duration:.01ms!important}}}@layer fonts{@font-face{font-display:swap;font-family:Clear Sans;font-style:normal;font-weight:300;src:local(""),url(/assets/fonts/clearsans/clearsans-light.woff2) format("woff2")}@font-face{font-display:swap;font-family:Clear Sans;font-style:normal;font-weight:400;src:local(""),url(/assets/fonts/clearsans/clearsans-regular.woff2) format("woff2")}@font-face{font-display:swap;font-family:Clear Sans;font-style:italic;font-weight:400;src:local(""),url(/assets/fonts/clearsans/clearsans-italic.woff2) format("woff2")}@font-face{font-display:swap;font-family:Clear Sans;font-style:normal;font-weight:500;src:local(""),url(/assets/fonts/clearsans/clearsans-medium.woff2) format("woff2")}@font-face{font-display:swap;font-family:Clear Sans;font-style:normal;font-weight:700;src:local(""),url(/assets/fonts/clearsans/clearsans-bold.woff2) format("woff2")}}@layer tailwindComponents{:root{--color-gray-100:#f5f5f6;--color-gray-200:#dedede;--color-gray-300:#aeaeae;--color-gray-400:#808081;--color-gray-500:#636364;--color-gray-600:#484749;--color-gray-700:#3a3a3c;--color-gray-800:#2e2e2f;--color-gray-900:#242425;--color-blue-100:#e8f1ff;--color-blue-200:#d4e9ff;--color-blue-300:#a9cbff;--color-blue-400:#83a4ff;--color-blue-500:#5a78fc;--color-blue-600:#3b51d3;--color-blue-700:#2936b7;--color-blue-800:#202b94;--color-blue-900:#070846;--color-gold:#dfba56;--color-pink:#c23797;--border-radius-small:1.5px;--border-radius-medium:3px;--border-radius-full:50%;--space-4xs:clamp(0.125rem,0.11rem + 0.10vw,0.1875rem);--space-3xs:clamp(0.3125rem,0.29rem + 0.10vw,0.375rem);--space-2xs:clamp(0.5625rem,0.52rem + 0.19vw,0.6875rem);--space-xs:clamp(0.875rem,0.82rem + 0.29vw,1.0625rem);--space-s:clamp(1.125rem,1.05rem + 0.38vw,1.375rem);--space-m:clamp(1.6875rem,1.57rem + 0.58vw,2.0625rem);--space-l:clamp(2.25rem,2.10rem + 0.77vw,2.75rem);--space-xl:clamp(3.375rem,3.14rem + 1.15vw,4.125rem);--space-2xl:clamp(5.625rem,5.24rem + 1.92vw,6.875rem);--space-3xl:clamp(9rem,8.38rem + 3.08vw,11rem);--space-4xl:clamp(14.625rem,13.63rem + 5.00vw,17.875rem);--space-3xs-2xs:clamp(0.3125rem,0.20rem + 0.58vw,0.6875rem);--space-2xs-xs:clamp(0.5625rem,0.41rem + 0.77vw,1.0625rem);--space-xs-s:clamp(0.875rem,0.72rem + 0.77vw,1.375rem);--space-s-m:clamp(1.125rem,0.84rem + 1.44vw,2.0625rem);--space-m-l:clamp(1.6875rem,1.36rem + 1.63vw,2.75rem);--space-l-xl:clamp(2.25rem,1.67rem + 2.88vw,4.125rem);--space-l-2xl:clamp(2.25rem,0.83rem + 7.12vw,6.875rem);--space-xl-2xl:clamp(3.375rem,2.30rem + 5.38vw,6.875rem);--space-2xl-3xl:clamp(5.625rem,3.97rem + 8.27vw,11rem);--size-step-min-2:clamp(0.6875rem,0.65rem + 0.19vw,0.8125rem);--size-step-min-1:clamp(0.9375rem,0.92rem + 0.10vw,1rem);--size-step-0:clamp(1.125rem,1.05rem + 0.38vw,1.375rem);--size-step-1:clamp(1.25rem,1.13rem + 0.58vw,1.625rem);--size-step-2:clamp(1.375rem,1.20rem + 0.87vw,1.9375rem);--size-step-3:clamp(1.625rem,1.28rem + 1.73vw,2.75rem);--size-step-4:clamp(1.9375rem,1.32rem + 3.08vw,3.9375rem);--size-step-5:clamp(2.3125rem,1.33rem + 4.90vw,5.5rem);--size-step-logo:clamp(1.375rem,1.03rem + 1.73vw,2.5rem);--leading-flat:1;--leading-fine:1.2;--leading-standard:1.5;--font-display:Clear Sans,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;--font-base:Clear Sans,system-ui,sans-serif;--font-mono:ui-monospace,Cascadia Code,Source Code Pro,Menlo,Consolas,DejaVu Sans Mono,monospace;--font-light:300;--font-regular:400;--font-medium:500;--font-bold:700}}@layer variables{:root{--gap:clamp(1rem,6vw,3rem);--gutter:var(--space-m-l);--transition-duration:250ms;--transition-timing:ease;--tracking:-0.05ch;--tracking-s:-0.075ch;--tracking-wide:0.05ch;--stroke:1px solid var(--color-bg-accent-2);--gradient-rainbow:linear-gradient(90deg,#cf4662 10%,#fbbe25 30%,#62c95c 50%,#08bccb 75%,#a977d5 90%);--gradient-conic:conic-gradient(var(--color-blue) 0 28%,var(--color-pink) 0 67%,var(--color-gold) 0 100%);--gradient-stripes:linear-gradient(45deg,var(--color-dark) 0 75%,var(--color-blue) 0 85%,var(--color-pink) 0 92%,var(--color-gold) 0 100%);--color-dark:var(--color-gray-900);--color-light:var(--color-gray-100);--color-mid:var(--color-gray-400)}:root,:root[data-theme=light]{--color-text:var(--color-gray-900);--color-text-accent:var(--color-gray-800);--color-bg:#fff;--color-bg-accent:var(--color-gray-100);--color-bg-accent-2:var(--color-gray-200);--color-bg-accent-3:var(--color-gray-300);--color-blue:var(--color-blue-500);--color-blue-accent:var(--color-blue-100);--color-blue-accent-2:var(--color-blue-900);--color-blue-accent-3:var(--color-blue-200);--color-blue-accent-4:var(--color-blue-600);--color-blue-accent-5:var(--color-blue);--color-blue-accent-6:var(--color-blue-800);img{filter:brightness(1)}}@media (prefers-color-scheme:dark){:root{--color-text:var(--color-gray-100);--color-bg:var(--color-gray-800);--color-blue:var(--color-blue-600);--color-blue-accent:var(--color-gray-900);--color-blue-accent-2:var(--color-blue-300);--color-blue-accent-3:var(--color-gray-100);--color-blue-accent-4:var(--color-blue-400);--color-blue-accent-5:var(--color-gray-900);--color-blue-accent-6:var(--color-gray-800);--color-text-accent:var(--color-gray-100);--color-bg-accent:var(--color-gray-900);--color-bg-accent-2:var(--color-gray-700);--color-bg-accent-3:var(--color-gray-700);img{filter:brightness(.9)}}}:root[data-theme=dark]{--color-text:var(--color-gray-100);--color-bg:var(--color-gray-800);--color-blue:var(--color-blue-600);--color-blue-accent:var(--color-gray-900);--color-blue-accent-2:var(--color-blue-300);--color-blue-accent-3:var(--color-gray-100);--color-blue-accent-4:var(--color-blue-400);--color-blue-accent-5:var(--color-gray-900);--color-blue-accent-6:var(--color-gray-800);--color-text-accent:var(--color-gray-100);--color-bg-accent:var(--color-gray-900);--color-bg-accent-2:var(--color-gray-700);--color-bg-accent-3:var(--color-gray-700);img{filter:brightness(.9)}}}@layer global{html{color-scheme:light dark}body{accent-color:var(--color-blue);background-color:var(--color-bg);color:var(--color-text);display:flex;flex-direction:column;font-family:var(--font-base);font-size:var(--size-step-0);font-size-adjust:from-font;font-weight:var(--font-regular);line-height:var(--leading-standard)}main{flex:auto}h1,h2,h3{font-family:var(--font-display);font-weight:var(--font-medium);letter-spacing:var(--tracking-s);line-height:var(--leading-fine)}h1{font-size:var(--size-step-4)}h2{font-size:var(--size-step-3)}h3{font-size:var(--size-step-2)}blockquote:not([class]),li,p{max-inline-size:65ch}blockquote{background:var(--color-bg-accent);border-radius:var(--border-radius-small);font-size:var(--size-step-min-1);font-style:italic;font-weight:var(--font-regular);line-height:var(--leading-normal);padding-block:var(--space-s);padding-inline:var(--space-xl) var(--space-m-l);position:relative}blockquote:before{color:var(--color-blue);content:"“";font-size:var(--size-step-5);inset-block-start:var(--space-xs);inset-inline-start:-.2em;position:absolute;text-box-trim:trim-both;text-box-edge:cap alphabetic}blockquote>*+*{margin-block-start:var(--space-m-l)}input,textarea{caret-color:var(--color-blue)}svg{block-size:2ex;flex:none;inline-size:auto;stroke-width:2;vector-effect:non-scaling-stroke}b,strong{font-weight:var(--font-bold)}hr{background-color:var(--color-bg-accent-2);border:0;height:1px;margin-block:var(--space-m-l);margin-inline-start:0;width:10%}a,button.underline{color:currentcolor;text-decoration-thickness:.08em}mark{background:var(--color-gold)}a:hover{text-decoration:none}:focus-visible{outline:3px solid;outline-offset:.3ch}::-moz-selection{background-color:var(--color-text);color:var(--color-bg)}::selection{background-color:var(--color-text);color:var(--color-bg)}.preload-transitions *{transition:none!important}@media (scripting:none){.require-js{display:none}}}@layer compositions{.cluster{align-items:var(--cluster-vertical-alignment,center);display:flex;flex-wrap:var(--cluster-wrap,wrap);gap:var(--gutter,var(--space-s-l));justify-content:var(--cluster-horizontal-alignment,flex-start)}.flow>*+*{margin-block-start:var(--flow-space,1em)}.grid{display:grid;gap:var(--gutter,var(--space-s-m));grid-template-columns:repeat(var(--grid-placement,auto-fill),minmax(var(--grid-min-item-size,16rem),1fr))}.grid[data-rows=masonry]{align-items:start;grid-template-rows:masonry}.grid[data-layout="50-50"]{--grid-placement:auto-fit;--grid-min-item-size:clamp(16rem,50vw,28rem)}.grid[data-layout="50-50-small"]{--grid-placement:auto-fit;--grid-min-item-size:clamp(16rem,50vw,20rem)}.grid[data-layout=thirds]{--grid-placement:auto-fit;--grid-min-item-size:clamp(16rem,33%,30rem)}.grid[data-layout=thirds-small]{--grid-placement:auto-fit;--grid-min-item-size:clamp(16rem,33%,20rem)}.repel{align-items:var(--repel-vertical-alignment,center);display:flex;flex-wrap:wrap;gap:var(--gutter,var(--space-s-l));justify-content:space-between}.repel[data-nowrap]{flex-wrap:nowrap}.sidebar{display:flex;flex-wrap:wrap;gap:var(--gutter,var(--space-s-l))}.sidebar:not([data-direction])>:first-child{flex-basis:var(--sidebar-target-width,20rem);flex-grow:1}.sidebar:not([data-direction])>:last-child{flex-basis:0;flex-grow:999;min-inline-size:var(--sidebar-content-min-width,50%)}.sidebar[data-direction=rtl]>:last-child{flex-basis:var(--sidebar-target-width,20rem);flex-grow:1}.sidebar[data-direction=rtl]>:first-child{flex-basis:0;flex-grow:999;min-inline-size:var(--sidebar-content-min-width,50%)}.wrapper{--wrapper-width:53rem;--gap:clamp(1rem,6vw,3rem);--full:minmax(var(--gap),1fr);--content:min(var(--wrapper-width,85rem),100% - var(--gap) * 2);--popout:minmax(0,2rem);--feature:minmax(0,5rem);display:grid;grid-template-columns:[full-start] var(--full) [feature-start] var(--feature) [popout-start] var(--popout) [content-start] var(--content) [content-end] var(--popout) [popout-end] var(--feature) [feature-end] var(--full) [full-end]}.wrapper>*{grid-column:content}.popout{grid-column:popout}.feature{grid-column:feature}.full{grid-column:full}}@layer blocks{.button{--button-bg:var(--color-text);--button-color:color-mix(in oklab,var(--button-bg) 10%,var(--color-bg));--button-hover-bg:color-mix(in oklab,var(--button-bg) 90%,var(--color-bg));--button-hover-color:color-mix(in oklab,var(--button-bg) 5%,var(--color-bg));--button-border-width:var(--border-thickness);--button-border-style:solid;--button-border-color:color-mix(in oklab,var(--button-bg) 95%,var(--color-text));--button-radius:var(--border-radius-small);--button-font-weight:var(--font-bold);--button-gap:var(--space-2xs);--button-padding:var(--space-3xs) var(--space-xs);--button-font-size:var(--size-step-0);--button-text-transform:none;align-items:center;background:var(--button-bg);border-color:var(--button-border-color);border-radius:var(--button-radius);border-style:var(--button-border-style);border-width:var(--button-border-width);color:var(--button-color);display:inline-flex;font-size:var(--button-font-size);font-weight:var(--button-font-weight);gap:var(--button-gap);line-height:var(--leading-flat);padding:var(--button-padding);text-decoration:none;text-transform:var(--button-text-transform);text-box-trim:trim-both;text-box-edge:cap alphabetic}.button svg{block-size:var(--button-icon-size,1.2cap);flex:none}.button:hover,.button[aria-current=page],.button[aria-pressed=true],.button[data-state=active]{background:var(--button-hover-bg);color:var(--button-color)}.button:focus{outline-color:var(--button-outline-color,var(--button-border-color))}.button:active{transform:scale(99%)}.button[data-button-variant=blue]{--button-bg:var(--color-blue);--button-color:var(--color-blue-100)}.button[data-button-variant=pink]{--button-bg:var(--color-pink);--button-color:var(--color-light)}.button[data-button-variant=gold]{--button-bg:var(--color-gold);--button-color:var(--color-dark)}.button[data-ghost-button]{--button-bg:var(--color-bg);--button-border-color:var(--color-text);--button-color:var(--color-text);--button-hover-color:var(--color-bg)}.button[data-ghost-button-reverse]{--button-bg:var(--color-text);--button-border-color:var(--color-bg);--button-color:var(--color-bg);--button-hover-color:var(--color-text)}.button[data-ghost-button]:hover{--_ghost-hover-bg:var(--button-bg);--_ghost-hover-bg:color-mix(in oklab,var(--button-bg) 95%,var(--color-dark));background:var(--_ghost-hover-bg)}.button[data-small-button]{--button-border-width:2px;--button-radius:var(--border-radius-small);--button-font-size:var(--size-step-min-2);--button-padding:var(--space-4xs) var(--space-2xs);--button-text-transform:uppercase;--button-font-weight:var(--font-regular)}.button[data-pill-button]{--button-radius:var(--border-radius-medium);--button-bg:var(--color-bg-accent-2);--button-color:var(--color-text);--button-border-width:0;--button-padding:var(--space-3xs) var(--space-2xs);--button-font-weight:var(--font-regular)}code,pre{background-color:var(--color-dark);border-radius:var(--border-radius-medium);color:var(--color-light);font-family:var(--font-mono);font-size:var(--size-step-min-1)}code[class*=language-],pre[class*=language-]{white-space:pre;word-break:normal;word-spacing:normal;word-wrap:normal;hyphens:none}pre{grid-column:popout!important;overflow-x:auto;padding:var(--space-s) var(--space-l)}:where(:not(pre))>code{padding:.1em .4em;position:relative;top:-.05em}pre[class*=language-]{overflow:auto;position:relative}[class*=language-] .namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.consent{background-color:var(--color-text);border:1px solid var(--color-bg-accent);color:var(--color-bg);font-size:var(--size-step-min-1);inset-block-end:0;inset-inline-start:0;margin:var(--gap);max-inline-size:min(95vw,30rem);padding:var(--space-s);position:fixed;z-index:10}.consent.contain{--margin:0px;max-block-size:calc(100% - var(--margin)*2);max-inline-size:calc(100% - var(--margin)*2);overflow:auto}.consent .service-item{border-block-start:1px solid var(--color-bg-accent-2);border-radius:var(--button-radius-small);padding-block:var(--space-2xs)}dialog{border-radius:var(--border-radius-small);inset:revert}dialog+button{--flow-space:0;cursor:zoom-in}is-land:not(:defined) dialog+button{cursor:default}dialog::backdrop{background:var(--color-dark);filter:brightness(50%);opacity:.9}dialog .button{--button-bg:var(--color-light);--button-color:var(--color-dark)}dialog img{max-block-size:80vh;max-inline-size:min(95vw,67rem);-o-object-fit:contain;object-fit:contain}dialog figcaption{color:var(--color-light)}a[href^=http]:not([href*="localhost:8080"]):not([href*="eleventy-excellent.netlify.app"]):not(.button){padding-inline-end:.8em}a[href^=http]:not([href*="localhost:8080"]):not([href*="eleventy-excellent.netlify.app"]):not(.button):not(.no-indicator):after{background-image:url(/assets/images/template/external.svg);background-position:50%;background-repeat:no-repeat;background-size:60% auto;block-size:1em;content:"(external link)";display:inline-block;inline-size:1em;overflow:hidden;position:absolute;text-indent:1em;white-space:nowrap}.faq .prose ul{padding-inline-start:.2ch}.faq .prose li::marker{color:var(--color-pink);content:""}.faq .prose ul ul{margin-top:var(--space-s);padding-inline-start:1ch}.faq .prose li li::marker{color:var(--color-pink);content:"- "}.mainnav{--nav-list-timing-function:cubic-bezier(0.68,-0.55,0.27,1.55);inset-inline-end:0;order:1;position:var(--nav-position,absolute)}.mainnav:has(.nav-drawer-toggle[aria-expanded=true]){--nav-position:fixed;inset-inline-end:var(--gap)}.mainnav ul{--gutter:var(--space-xs) var(--space-3xs);--cluster-vertical-alignment:center;--cluster-horizontal-alignment:flex-start;--nav-list-background:var(--color-bg-accent);--nav-list-shadow:-5px 0 11px 0 rgba(0,0,0,.2);--nav-list-layout:column;--nav-list-height:100dvh;--nav-list-padding:var(--space-2xl) var(--space-s);--nav-list-position:fixed;--nav-list-width:min(25rem,100vw);--nav-list-visibility:hidden;--nav-list-opacity:0;--nav-list-margin:0;--nav-list-align-items:stretch;align-items:var(--nav-list-align-items);background:var(--nav-list-background);block-size:var(--nav-list-height);box-shadow:var(--nav-list-shadow);display:flex;flex-direction:var(--nav-list-layout);flex-wrap:wrap;inline-size:var(--nav-list-width);inset-block-start:0;inset-inline-end:0;list-style:none;margin:var(--nav-list-margin);opacity:var(--nav-list-opacity);padding:var(--nav-list-padding);position:var(--nav-list-position);transition:opacity .3 var(--nav-list-timing-function),visibility .3s ease-in-out;visibility:var(--nav-list-visibility)}.mainnav ul[no-flash]{transition:none}@media (prefers-reduced-motion:no-preference){.mainnav>ul{--nav-list-transform:translateX(100%);--nav-list-opacity:1;transform:var(--nav-list-transform);transition:transform .5s var(--nav-list-timing-function),visibility .3s linear}.mainnav svg{transition:transform .4s var(--nav-list-timing-function)}}.mainnav .nav-drawer-toggle[aria-expanded=true]+ul{--nav-list-visibility:visible;--nav-list-transform:translateX(0);--nav-list-opacity:1}body:has(.nav-drawer-toggle[aria-expanded=true]){overflow:hidden}.mainnav .nav-drawer-toggle{--gutter:0.2em;--cluster-vertical-alignment:center;background:var(--color-blue);border-radius:var(--border-radius-medium);color:var(--color-light);display:var(--nav-button-display,flex);line-height:var(--leading-flat);padding:var(--space-3xs);position:relative;z-index:2}.mainnav span{font-family:var(--font-display);font-size:var(--size-step-min-1);font-weight:var(--font-medium);text-transform:uppercase}.mainnav svg{block-size:.8em;color:var(--color-text);stroke-width:2.5;pointer-events:auto}.mainnav .nav-drawer-toggle svg{color:var(--color-light)}.mainnav .nav-drawer-toggle[aria-expanded=true] svg{transform:rotate(45deg)}.mainnav :is(a,.nav-sublist-toggle){--nav-item-background:transparent;--nav-item-text-color:var(--color-text);--nav-item-padding:var(--space-3xs) var(--space-4xs);--nav-item-decoration-color:transparent;background:var(--nav-item-background);border-radius:var(--border-radius-small);color:var(--nav-item-text-color);display:block;font-weight:var(--font-medium);line-height:var(--leading-flat);padding:var(--nav-item-padding);text-decoration-color:var(--nav-item-decoration-color);text-decoration-line:underline;text-decoration-thickness:3px;text-underline-offset:.2em;text-box-trim:trim-both;text-box-edge:cap alphabetic}@media (max-width:800px){.mainnav :is(a,.nav-sublist-toggle){font-size:var(--size-step-1);inline-size:100%}.mainnav .nav-sublist a{font-size:var(--size-step-0)}}.mainnav :is(a,.nav-sublist-toggle):hover{--nav-item-background:transparent;--nav-item-text-color:var(--color-text);--nav-item-decoration-color:var(--color-text)}.mainnav [aria-current=page],.mainnav [data-state=active]{--nav-item-background:transparent;--nav-item-text-color:var(--color-text);--nav-item-decoration-color:var(--color-text)}.mainnav .nav-sublist-toggle{overflow:visible}.mainnav .nav-sublist-toggle[aria-expanded=false]+ul{display:none}.mainnav .nav-sublist{--nav-sublist-position:relative;--nav-sublist-background:var(--color-bg);--nav-sublist-border:transparent;--nav-sublist-width:100%;--nav-list-visibility:visible;--nav-list-opacity:1;background:var(--nav-sublist-background);block-size:auto;border:3px solid var(--nav-sublist-border);box-shadow:none;display:flex;flex-direction:column;gap:var(--space-2xs);inline-size:var(--nav-sublist-width);padding:var(--space-2xs);position:var(--nav-sublist-position);z-index:2}.mainnav .nav-sublist-toggle[aria-expanded=true] svg{transform:rotate(45deg)}.mainnav li:has(a[data-state=active]) button{--nav-item-background:transparent;--nav-item-text-color:var(--color-text);--nav-item-decoration-color:var(--color-text)}.mainnav>ul:first-of-type>li:last-child a{--nav-item-background:var(--color-blue);--nav-item-text-color:var(--color-light);--nav-item-padding:var(--space-2xs)}.mainnav>ul:first-of-type>li:last-child [aria-current=page],.mainnav>ul:first-of-type>li:last-child a:is(:hover,:focus){--nav-item-background:var(--color-text);--nav-item-decoration-color:transparent;--nav-item-text-color:var(--color-bg)}@media (min-width:800px){.mainnav{margin-inline-end:var(--space-xl);order:0;--nav-position:static;--nav-button-display:none}.mainnav ul{--gutter:var(--space-2xs);--cluster-horizontal-alignment:flex-start;--nav-list-layout:row;--nav-list-position:static;--nav-list-padding:0;--nav-list-margin:0;--nav-list-height:auto;--nav-list-width:auto;--nav-list-shadow:none;--nav-list-visibility:visible;--nav-list-opacity:1;--nav-list-transform:translateX(0);--nav-list-align-items:center}.mainnav a{--nav-item-padding:var(--space-xs) var(--space-2xs);--nav-item-font-size:var(--size-step-0)}.mainnav .nav-sublist-toggle{--nav-item-padding:var(--space-2xs) var(--space-3xs)}.mainnav .nav-sublist{--nav-sublist-position:absolute;--nav-sublist-background:var(--color-bg-accent-2);--nav-sublist-border:transparent;--nav-sublist-width:10em;align-items:stretch;inset-block-start:calc(var(--space-xl) - var(--space-2xs) + 1px);inset-inline-start:calc(var(--space-2xs)/-1)}}.mainnav ul:first-child{--cluster-horizontal-alignment:flex-start;--nav-list-layout:row;--nav-list-position:static;--nav-list-padding:0;--nav-list-margin:0;--nav-list-height:auto;--nav-list-width:auto;--nav-list-shadow:none;--nav-list-visibility:visible;--nav-list-opacity:1;--nav-list-transform:translateX(0);--nav-list-align-items:center;margin-inline:calc(var(--space-4xs)/-1)}.mainnav:has(ul:first-child){--nav-position:relative}.page.simple :is(h2,h3,h4){font-weight:var(--font-bold)}.page.simple h2{font-size:var(--size-step-1)}.page.simple h3{font-size:var(--size-step-0)}.search-toggle{background:none;border:none;cursor:pointer;display:flex;justify-content:flex-start;margin-inline-end:4em;order:0;padding:var(--space-3xs) var(--space-2xs)}.search-toggle svg{block-size:auto;stroke-width:2.5px;font-size:var(--size-step-0)}@media (min-width:800px){.search-toggle{inset-block-start:0;inset-inline-end:0;margin-inline-end:0;padding:var(--space-2xs);position:absolute}}pagefind-search{inline-size:min(100%,25rem);inset-inline-end:0;position:absolute;top:120%}.pagefind-ui form{block-size:var(--space-m);display:flex;position:relative}.pagefind-ui form:before{background-color:var(--color-text);block-size:1ch;content:"";inline-size:1ch;inset-block-start:.8ch;inset-inline-start:1ch;-webkit-mask-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjEuNSIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Im0yMSAyMS01LjE5Ny01LjE5N20wIDBBNy41IDcuNSAwIDEgMCA1LjE5NiA1LjE5NmE3LjUgNy41IDAgMCAwIDEwLjYwNyAxMC42MDciLz48L3N2Zz4=);mask-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjEuNSIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Im0yMSAyMS01LjE5Ny01LjE5N20wIDBBNy41IDcuNSAwIDEgMCA1LjE5NiA1LjE5NmE3LjUgNy41IDAgMCAwIDEwLjYwNyAxMC42MDciLz48L3N2Zz4=);position:absolute}.pagefind-ui input{color:var(--color-text);font-size:var(--size-step-min-1);padding-inline-end:1rem;padding-inline-start:2.25rem}.pagefind-ui .pagefind-ui__results-area,.pagefind-ui input{background-color:var(--color-bg-accent);border:2px solid var(--color-bg-accent-2);border-radius:var(--border-radius-small);inline-size:100%}.pagefind-ui .pagefind-ui__results-area{inset-inline-end:0;inset-inline-start:0;inset-inline-start:auto;margin-block-start:var(--space-l);overflow:hidden;position:absolute}.pagefind-ui ol{display:flex;flex-direction:column;gap:var(--space-2xs);max-block-size:50vh;overflow-y:auto;padding:var(--space-xs)}.pagefind-ui li{border:1px solid var(--color-bg-accent-2);border-radius:var(--border-radius-small);list-style:none;padding:var(--space-xs)}.pagefind-ui li:focus-within,.pagefind-ui li:hover{background-color:var(--color-bg-accent-2);border:1px solid var(--color-bg)}.pagefind-ui li:focus-within a:focus{outline:none}.pagefind-ui li{position:relative}.pagefind-ui li a:after{content:"";inset:0;position:absolute}.pagefind-ui .pagefind-ui__result-title{font-weight:var(--font-medium);margin-block-end:var(--space-xs)}.pagefind-ui .pagefind-ui__result-excerpt{font-size:var(--size-step-min-1)}.pagefind-ui .pagefind-ui__button,.pagefind-ui .pagefind-ui__hidden,.pagefind-ui .pagefind-ui__message,.pagefind-ui .pagefind-ui__search-clear{display:none}.pagefind-ui .pagefind-ui__message:has(+ol:empty){color:var(--color-text);display:block;padding:var(--space-xs);text-align:center}.pagefind-ui .pagefind-ui__message+ol:empty{display:none}@layer prose{.prose{--flow-space:var(--space-s-m)}.prose :where(pre,pre+*,figure,figure+*){--flow-space:var(--space-m-l)}.prose figcaption{border-bottom:1px solid var(--color-bg-accent);font-size:var(--size-step-min-1);margin-block-end:var(--space-s);padding-block-end:var(--space-xs);text-align:center}:where(.prose :is(h2,h3,h4)){--flow-space:var(--space-xl)}:where(.prose :is(h2+*,h3+*,h4+*):not(figure)){--flow-space:var(--space-m)}.prose .heading-anchor:is(:hover,:focus){text-decoration:none}.heading-anchor{text-decoration:none}.prose mark{background-color:var(--color-gold);color:var(--color-dark)}.prose :not(.cluster):not(.grid)>li+li{padding-block-start:var(--list-padding,var(--space-2xs))}.prose ul:not(.grid){padding-inline-start:1.3ch}.prose ol:not(.grid){padding-inline-start:2ch}.prose :where(ul:not(.grid):not([role=list])) li::marker{color:var(--color-blue);content:"– "}.prose ol li::marker{color:var(--color-blue)}.prose img{border-radius:var(--border-radius-small)}@media (max-width:800px){.prose a,.prose>*{overflow-wrap:break-word;word-wrap:break-word;hyphens:auto;word-break:break-word}}}.section>.seperator:first-child{transform:rotate(180deg) translateY(-1px)}.section__inner{background-color:var(--spot-color,var(--color-bg-accent));color:var(--color-text)}.section blockquote{font-size:var(--size-step-4);font-weight:var(--font-bold);letter-spacing:var(--tracking-s);line-height:1}.section :is(h1,h2,h3,blockquote){opacity:95%}.seperator{block-size:3.5em;display:block;inline-size:100%;fill:var(--spot-color,var(--color-bg))}.section>.seperator{transform:translateY(-1px)}.seperator.small{block-size:1.5em}.site-footer{color:var(--color-text);padding:var(--space-s-m)}.site-footer .footer__meta{--gutter:var(--space-xs);--cluster-horizontal-alignment:center}.site-footer .footer__meta a{padding:var(--space-3xs)}.site-footer .footer__meta dialog+button{cursor:pointer!important}.site-footer svg{stroke-width:2;block-size:1em;inline-size:1.1em}.site-footer .creator{display:grid;font-size:var(--size-step-min-1);margin-block-start:var(--space-xl);place-items:center}.site-footer .creator a{--gutter:var(--space-xs);--cluster-horizontal-alignment:center;text-decoration:none}.site-footer .creator a:hover{-webkit-background-clip:text;background-clip:text;background-image:var(--gradient-rainbow);background-repeat:repeat;background-size:100%;color:transparent}.site-footer .creator:hover svg{color:var(--color-text)}.site-header{background:var(--color-bg-accent);padding-block:var(--space-xs);z-index:2}.logo{display:grid;font-size:var(--size-step-logo);font-weight:var(--font-medium);gap:0;justify-items:end;position:relative;text-decoration:none}@media (min-width:800px){.logo{padding-block:var(--space-3xs)}}.logo svg{block-size:auto;color:var(--color-blue-500)}.logo .dyvenia svg{block-size:1.15lh}.skip-link{clip:rect(1px,1px,1px,1px);block-size:1px;display:block;inline-size:1px;left:1rem;overflow:hidden;position:absolute;top:1rem;z-index:999}.skip-link:focus{clip:auto;background-color:var(--color-text);block-size:auto;border-radius:var(--border-radius-small);color:var(--color-bg);inline-size:auto;line-height:1;overflow:visible;padding:var(--space-xs) var(--space-s-m)}.skip-link:not(:focus){border:0;clip:rect(0 0 0 0);block-size:auto;inline-size:1px;margin:0;overflow:hidden;padding:0;position:absolute;white-space:nowrap}table-saw{display:block}table{border:var(--stroke);border-collapse:collapse;width:100%}th{background:var(--color-bg-accent);font-weight:var(--font-bold);line-height:var(--leading-fine);text-align:left}thead th{padding-block:var(--space-2xs)}td,th{padding:var(--space-2xs) var(--space-xs)}th:not(:only-of-type){border-block-end:var(--stroke)}th:only-of-type{border-inline-end:var(--stroke)}tr:not(:first-of-type){border-block-start:var(--stroke)}@media (min-width:670px){:is(th,td)~:is(th,td){border-inline-start:var(--stroke)}tr+tr :is(th,td){border-block-start:var(--stroke)}}.theme-switch h2{font-family:var(--font-base);font-size:var(--size-step-min-1)}.theme-switch .button{--button-border-color:var(--color-text);--button-border-width:2px;--button-color:var(--color-light);--button-bg:var(--color-dark);border-radius:var(--border-radius-small);font-family:var(--font-display);font-size:var(--size-step-min-2);font-weight:var(--font-semi-bold);min-block-size:1.5em;padding:.1rem .625rem;text-transform:uppercase}.theme-switch .button[aria-pressed=true]{--_color-primary-contrast:var(--color-blue-600);--button-bg:var(--_color-primary-contrast);--button-color:var(--color-light);--button-border-color:var(--_color-primary-contrast);outline-color:var(--_color-primary-contrast)}is-land:not(:defined) .theme-switch{display:none}}@layer tailwindUtilities{.invisible{visibility:hidden}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.isolate{isolation:isolate}.mx-auto{margin-left:auto;margin-right:auto}.my-s-m{margin-bottom:clamp(1.125rem,.84rem + 1.44vw,2.0625rem);margin-top:clamp(1.125rem,.84rem + 1.44vw,2.0625rem)}.mb-l{margin-bottom:clamp(2.25rem,2.1rem + .77vw,2.75rem)}.mb-m{margin-bottom:clamp(1.6875rem,1.57rem + .58vw,2.0625rem)}.mt-2xl{margin-top:clamp(5.625rem,5.24rem + 1.92vw,6.875rem)}.mt-l-xl{margin-top:clamp(2.25rem,1.67rem + 2.88vw,4.125rem)}.mt-m{margin-top:clamp(1.6875rem,1.57rem + .58vw,2.0625rem)}.mt-s-m{margin-top:clamp(1.125rem,.84rem + 1.44vw,2.0625rem)}.mt-xl{margin-top:clamp(3.375rem,3.14rem + 1.15vw,4.125rem)}.mt-xl-2xl{margin-top:clamp(3.375rem,2.3rem + 5.38vw,6.875rem)}.mt-xs{margin-top:clamp(.875rem,.82rem + .29vw,1.0625rem)}.block{display:block}.inline{display:inline}.flex{display:flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.resize{resize:both}.items-start{align-items:flex-start}.justify-center{justify-content:center}.text-balance{text-wrap:balance}.rounded-full{border-radius:50%}.rounded-medium{border-radius:3px}.object-cover{-o-object-fit:cover;object-fit:cover}.p-2xs{padding:clamp(.5625rem,.52rem + .19vw,.6875rem)}.pb-m{padding-bottom:clamp(1.6875rem,1.57rem + .58vw,2.0625rem)}.pt-l-xl{padding-top:clamp(2.25rem,1.67rem + 2.88vw,4.125rem)}.text-center{text-align:center}.text-step-0{font-size:clamp(1.125rem,1.05rem + .38vw,1.375rem)}.text-step-1{font-size:clamp(1.25rem,1.13rem + .58vw,1.625rem)}.text-step-2{font-size:clamp(1.375rem,1.2rem + .87vw,1.9375rem)}.text-step-3{font-size:clamp(1.625rem,1.28rem + 1.73vw,2.75rem)}.text-step-4{font-size:clamp(1.9375rem,1.32rem + 3.08vw,3.9375rem)}.text-step-min-1{font-size:clamp(.9375rem,.92rem + .1vw,1rem)}.text-step-min-2{font-size:clamp(.6875rem,.65rem + .19vw,.8125rem)}.font-bold{font-weight:700}.font-medium{font-weight:500}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.text-blue-100{color:#e8f1ff}.text-blue-500{color:#5a78fc}.text-gray-100{color:#f5f5f6}.text-gray-500{color:#636364}.text-pink{color:#c23797}.no-underline{text-decoration-line:none}.outline{outline-style:solid}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.flow-space-3xs{--flow-space:clamp(0.3125rem,0.29rem + 0.10vw,0.375rem)}.flow-space-2xs{--flow-space:clamp(0.5625rem,0.52rem + 0.19vw,0.6875rem)}.flow-space-xs{--flow-space:clamp(0.875rem,0.82rem + 0.29vw,1.0625rem)}.flow-space-s{--flow-space:clamp(1.125rem,1.05rem + 0.38vw,1.375rem)}.flow-space-l{--flow-space:clamp(2.25rem,2.10rem + 0.77vw,2.75rem)}.flow-space-xl{--flow-space:clamp(3.375rem,3.14rem + 1.15vw,4.125rem)}.region-space-l{--region-space:clamp(2.25rem,2.10rem + 0.77vw,2.75rem)}.region-space-xl{--region-space:clamp(3.375rem,3.14rem + 1.15vw,4.125rem)}.gutter-4xs{--gutter:clamp(0.125rem,0.11rem + 0.10vw,0.1875rem)}.gutter-3xs{--gutter:clamp(0.3125rem,0.29rem + 0.10vw,0.375rem)}.gutter-2xs{--gutter:clamp(0.5625rem,0.52rem + 0.19vw,0.6875rem)}.gutter-xs{--gutter:clamp(0.875rem,0.82rem + 0.29vw,1.0625rem)}.gutter-s{--gutter:clamp(1.125rem,1.05rem + 0.38vw,1.375rem)}.gutter-m{--gutter:clamp(1.6875rem,1.57rem + 0.58vw,2.0625rem)}.aspect-1{aspect-ratio:1}.blur{filter:blur(.25rem)}.border{border:var(--stroke)}.heading-line{align-items:flex-start;display:flex;text-align:left;&:after{background:var(--color-bg-accent-2);block-size:3px;content:"";flex-grow:1;margin-block-start:auto;margin-left:var(--space-s);transform:translateY(-.25em)}}.ontop{position:relative;z-index:1}.region{--region-space-fallback:var(--region-space,var(--space-xl-2xl));padding-block-end:var(--region-space-bottom,var(--region-space-fallback));padding-block-start:var(--region-space-top,var(--region-space-fallback))}@media (prefers-reduced-motion:no-preference){@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}}.svg-image{block-size:auto;inline-size:100%}.visually-hidden{border:0;clip:rect(0 0 0 0);height:0;margin:0;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px}}.hover\:underline:hover{text-decoration-line:underline}</style><style>form .sidebar{--flow-space:var(--space-xs);--gutter:0;--sidebar-target-width:min(25rem,25%);--sidebar-content-min-width:20%;max-inline-size:40rem}form .sidebar>*{--flow-space:var(--space-3xs)}:is(input:not([type=checkbox],[type=radio],[type=color]),select,textarea){background:var(--color-bg);block-size:-moz-max-content;block-size:max-content;border:1px solid var(--color-mid);border-radius:var(--border-radius-small);color:var(--color-text);inline-size:100%;max-inline-size:42rem;padding:calc(var(--space-3xs) + .05em) var(--space-xs)}input.no-right-line{border-inline-end:none}:is(input:not([type=checkbox],[type=radio],[type=color]),select,textarea)::-moz-placeholder{color:var(--color-mid);font-size:var(--size-step-min-1);opacity:1}:is(input:not([type=checkbox],[type=radio],[type=color]),select,textarea)::placeholder{color:var(--color-mid);font-size:var(--size-step-min-1);opacity:1}label{line-height:var(--leading-fine)}form button{block-size:-moz-max-content;block-size:max-content;justify-content:center;padding:var(--space-2xs) var(--space-xs);place-self:end}.form-control{display:grid;gap:var(--gutter);grid-template-columns:1em auto}.form-control+.form-control{margin-top:1em}input[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:var(--color-bg);border:1px solid var(--color-mid);border-radius:var(--border-radius-small);color:currentColor;cursor:pointer;display:grid;font:inherit;height:var(--space-s);margin:0;place-content:center;transform:translateY(-.075em);width:var(--space-s)}input[type=checkbox]:before{background-color:CanvasText;box-shadow:inset 1em 1em var(--color-blue);clip-path:polygon(14% 44%,0 65%,50% 100%,100% 16%,80% 0,43% 62%);content:"";height:var(--space-2xs);transform:scale(0);transform-origin:bottom left;transition:transform .12s ease-in-out;width:var(--space-2xs)}input[type=checkbox]:checked:before{transform:scale(1)}.newsletter{--flow-space:var(--space-l);background:var(--color-bg-accent);border-radius:var(--border-radius-small);color:var(--color-text);padding:var(--space-s)}.case-study .sidebar-newsletter>div{display:none}button+.newsletter{--flow-space:var(--space-xs);padding:var(--space-l) var(--space-s)}button+.newsletter>*{--flow-space:var(--space-l)}.full .newsletter{background:var(--color-bg);border-block-end:1px solid var(--color-bg-accent-2);padding:0}
.post h1+:is(picture,figure) img{aspect-ratio:16/9;block-size:auto;max-inline-size:var(--max-img-width,100%);-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center}.post .credit{background-color:var(--color-bg);border-radius:var(--border-radius-small);color:var(--color-text-accent);max-inline-size:-moz-fit-content;max-inline-size:fit-content;padding:var(--space-xs) var(--space-s);transform:translateY(-4ch) translateX(-.5ch)}.post .credit,.post .meta{font-size:var(--size-step-min-1)}.post .meta{max-inline-size:100%}.post .meta img{block-size:auto;inline-size:var(--space-l)}.post .meta span,.post .meta time{font-weight:var(--font-medium)}.post .meta time{color:var(--color-pink);text-transform:uppercase}.post img{background:var(--color-light)}.post .blog .wrapper>*{grid-column:feature}.post.case-study .blog .wrapper>*{grid-column:content}.post p:empty{display:none}.post p:empty:first-of-type+*{--flow-space:0}.post .toc-container{--flow-space:0;block-size:0}.post .toc-container h2{font-size:var(--size-step-1);text-transform:uppercase}.post .table-of-contents{border-block-end:1px solid var(--color-bg-accent-2);border-radius:var(--border-radius-small)}@media (min-width:51rem){.post .table-of-contents{background:transparent;border-block-end:none;border-inline-end:1px solid var(--color-bg-accent-2);padding:0;padding-inline-end:var(--space-s)}}.post .table-of-contents a{text-decoration:none}.post .table-of-contents a:hover{text-decoration:underline;text-decoration-thickness:.08em}.post .table-of-contents>ol{overflow-y:auto;padding-block-end:var(--space-xs);padding-inline-end:var(--space-m);position:sticky;top:var(--space-m)}.post .table-of-contents ol{font-size:var(--size-step-min-1);line-height:1.5em;margin-block-start:var(--space-3xs)}.post .table-of-contents ol ol{font-weight:400;list-style:lower-latin;padding-inline-start:1.8ch}.table-of-contents :is(ol ol ol,ol ol ol ol){display:none}.post .table-of-contents ol>li>ol>li+li{padding-block-start:var(--space-3xs)}.footnotes{font-size:var(--size-step-min-1)}.footnote-ref{color:var(--color-text-accent);font-size:var(--size-step-min-2);margin-inline-start:.1ch;vertical-align:super}.footnote-ref a{padding:.3ch;text-decoration:none}.footnote-backref{background-color:var(--color-bg-accent);border-radius:var(--border-radius-small);padding-inline:var(--space-xs);text-decoration:none}.footnote-backref:hover{color:var(--color-blue)}
@media (scripting:enabled){@media (max-width:800px){.mainnav>ul{display:none}}}</style><link rel="preload" href="/assets/fonts/clearsans/clearsans-regular.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/assets/fonts/clearsans/clearsans-light.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/assets/fonts/clearsans/clearsans-medium.woff2" as="font" type="font/woff2" crossorigin><script src="/bundle/rGy59ef-fr.js" type="module"></script><meta name="description" content="Learn how to set up a secure, scalable data platform infrastructure on Google Cloud Platform (GCP) using Terraform. This step-by-step guide covers VPC configuration, Compute Engine setup, firewall rules, Identity-Aware Proxy (IAP), Cloud NAT, and more, ensuring a cost-effective, flexible, and secure foundation for your data platform."><meta name="theme-color" content="#070846"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="generator" content="Eleventy v3.1.2"><meta name="format-detection" content="telephone=no"><meta name="color-scheme" content="light dark"><meta name="view-transition" content="same-origin"><link rel="canonical" href="http://localhost:8080/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/"><link rel="author" href="humans.txt"><meta property="og:url" content="http://localhost:8080/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/"><meta property="og:type" content="website"><meta property="og:title" content="How to Setup Data Platform Infrastructure on Google Cloud Platform with Terraform"><meta property="og:image" content="http://localhost:8080/assets/og-images/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform-preview.jpeg"><meta property="og:image:alt" content="How to Setup Data Platform Infrastructure on Google Cloud Platform with Terraform"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:description" content="Learn how to set up a secure, scalable data platform infrastructure on Google Cloud Platform (GCP) using Terraform. This step-by-step guide covers VPC configuration, Compute Engine setup, firewall rules, Identity-Aware Proxy (IAP), Cloud NAT, and more, ensuring a cost-effective, flexible, and secure foundation for your data platform."><meta property="og:site_name" content="The Scalable Way"><meta property="og:locale" content="en_EN"><meta property="article:author" content="The Scalable Way"><link rel="alternate" type="application/atom+xml" title="Atom Feed: The Scalable Way" href="/feed.xml"><link rel="alternate" type="application/json" title="JSON Feed: The Scalable Way" href="/feed.json"><link rel="icon" href="/favicon.ico" sizes="any"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"></head><body class="post relative"><header class="site-header | wrapper"><a href="#main" class="skip-link">Skip to content</a><div class="popout | relative repel ontop gutter-3xs items-start"><a href="/" class="logo"><svg xmlns="http://www.w3.org/2000/svg" width="6em" height="1em" fill="none" viewBox="0 0 655 80" aria-hidden="true"><g fill="#5977fc" clip-path="url(#a)"><path d="M133.803 14.46v7.324h-13.118v39.285h-7.657V21.784H99.844V14.46zM182.609 41.627h19.577c-.491-2.707-1.609-4.75-3.364-6.127q-2.629-2.063-6.159-2.064-3.996 0-6.658 2.197-2.664 2.198-3.396 5.994m.066 5.86q.799 3.794 3.663 5.825 2.862 2.031 6.991 2.03 5.726.001 8.589-4.127l5.927 3.462q-4.929 7.258-14.583 7.258-8.124 0-13.117-4.96-4.995-4.96-4.994-12.552 0-7.456 4.928-12.484 4.926-5.028 12.651-5.028 7.325 0 12.017 5.128 4.696 5.127 4.696 12.45 0 1.134-.266 2.998zM248.395 61.935q-6.726 0-11.418-3.062-4.697-3.063-6.559-8.391l6.591-3.861q2.796 7.857 11.585 7.857 4.329 0 6.493-1.693 2.163-1.692 2.164-4.416 0-2.856-2.333-4.351-2.335-1.494-8.268-3.287l-5.348-1.988q-2.095-.777-4.393-2.344-2.298-1.563-3.43-3.894-1.13-2.331-1.13-5.46 0-6.192 4.394-9.822 4.394-3.628 10.586-3.629 5.594 0 9.789 2.73t6.459 7.525l-6.459 3.728q-2.932-6.525-9.789-6.526-3.33 0-5.327 1.566-1.997 1.564-1.997 4.228 0 2.544 2.042 4.01 2.042 1.467 7.4 3.098 2.614.986 3.827 1.441l3.485 1.313q2.272.856 3.394 1.8t2.41 2.362a8.1 8.1 0 0 1 1.816 3.236q.529 1.821.53 4.113-.001 6.325-4.562 10.021-4.562 3.696-11.952 3.696M156.508 26.911q5.726 0 9.255 3.663 3.528 3.661 3.529 10.055v20.44H162.1V41.362q0-3.729-1.997-5.727t-5.459-1.997q-3.796 0-6.126 2.364t-2.331 7.224V61.07h-7.191V14.46h7.191v17.578q3.263-5.126 10.321-5.127M373.106 52.047q2.997 3.03 7.524 3.03t7.524-3.03q2.996-3.03 2.996-7.624t-2.996-7.624-7.524-3.029q-4.527 0-7.524 3.03t-2.996 7.623q0 4.594 2.996 7.624m18.044-24.27h7.192V61.07h-7.192v-4.795q-4.062 5.66-11.652 5.66-6.859 0-11.718-5.093-4.863-5.094-4.862-12.419 0-7.39 4.862-12.452 4.86-5.059 11.718-5.06 7.59 0 11.652 5.594zM287.678 61.935q-7.526 0-12.551-5.06-5.029-5.06-5.028-12.452 0-7.455 5.028-12.485 5.025-5.026 12.551-5.027 4.86 0 8.856 2.331t5.993 6.259l-6.193 3.596a8.52 8.52 0 0 0-3.43-3.763q-2.298-1.365-5.293-1.365-4.395 0-7.357 2.997t-2.963 7.457q0 4.462 2.963 7.458t7.357 2.996q2.93 0 5.293-1.398t3.563-3.729l6.192 3.53q-2.13 3.994-6.125 6.325t-8.856 2.33M315.645 52.047q2.997 3.03 7.524 3.03t7.524-3.03q2.996-3.03 2.996-7.624t-2.996-7.624-7.524-3.029-7.524 3.03q-2.996 3.03-2.996 7.623 0 4.594 2.996 7.624m18.044-24.27h7.192V61.07h-7.192v-4.795q-4.062 5.66-11.652 5.66-6.859 0-11.718-5.093-4.863-5.094-4.862-12.419 0-7.39 4.862-12.452 4.86-5.059 11.718-5.06 7.59 0 11.652 5.594zM349.271 12.462h7.19V61.07h-7.19zM416.919 52.047q2.995 3.03 7.524 3.03 4.526 0 7.524-3.03 2.996-3.03 2.996-7.624t-2.996-7.624q-2.998-3.03-7.524-3.029-4.53 0-7.524 3.03-2.998 3.03-2.998 7.623 0 4.594 2.998 7.624m8.656-25.136q6.857.001 11.718 5.06 4.861 5.061 4.862 12.452-.001 7.326-4.862 12.419t-11.718 5.093q-7.593 0-11.654-5.66v4.795h-7.19V14.46h7.19v18.045q4.062-5.594 11.654-5.594M448.679 12.462h7.19V61.07h-7.19zM469.784 41.627h19.578q-.735-4.061-3.364-6.127-2.63-2.063-6.159-2.064-3.996 0-6.659 2.197-2.664 2.198-3.396 5.994m.067 5.86q.798 3.794 3.663 5.825 2.862 2.031 6.99 2.03 5.727.001 8.59-4.127l5.926 3.462q-4.928 7.258-14.582 7.258-8.124 0-13.118-4.96t-4.993-12.552q0-7.456 4.928-12.484 4.925-5.028 12.651-5.028 7.324 0 12.017 5.128 4.696 5.127 4.696 12.45 0 1.134-.267 2.998zM529.426 61.07l-12.698-46.61h8.026l9.818 36.424 10.586-36.424h7.058l10.521 36.422 9.788-36.422h7.543l-12.67 46.61h-8.856l-9.864-34.147-9.924 34.147zM590.437 52.047q2.995 3.03 7.524 3.03 4.527 0 7.524-3.03t2.996-7.624q0-4.593-2.996-7.624t-7.524-3.029q-4.529 0-7.524 3.03t-2.996 7.623 2.996 7.624m18.044-24.27h7.192V61.07h-7.192v-4.795q-4.062 5.66-11.652 5.66-6.86 0-11.719-5.093-4.861-5.094-4.861-12.419 0-7.39 4.861-12.452 4.86-5.059 11.719-5.06 7.59 0 11.652 5.594zM646.501 27.777h7.657l-12.785 34.357q-4.794 12.918-16.246 12.252v-6.725q3.395.2 5.459-1.432t3.396-5.093l.333-.666-14.116-32.693h7.858l9.926 24.167zM34.37 0 0 19.843v39.684L34.37 79.37l34.367-19.844V19.843zM6.762 55.624V23.745L34.369 7.807l27.606 15.938v31.879L34.369 71.563z"></path><path d="M11.68 40.074v26.197L34.37 79.37l22.688-13.099V40.074L34.369 26.975zm6.764 22.293V43.978l15.925-9.195 15.925 9.195v18.39L34.37 71.562z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h654.158v79.371H0z"></path></clipPath></defs></svg> <span class="visually hidden">The Scalable Way </span><span class="dyvenia | cluster gutter-3xs text-step-min-2 text-gray-500">by <svg xmlns="http://www.w3.org/2000/svg" width="3em" height="1em" fill="none" viewBox="0 0 813 195" aria-hidden="true"><path fill="#0e909d" d="m151.1 136.4-67.2 38.8-67.3-38.8v-17.2c0-16 13-29.1 28.8-29.3h.6c15.8 0 23.5 6.6 32.4 14.2 10 8.5 21.3 18.2 43.3 18.2h.7c25.2-.2 45.7-21 45.7-46.3V49L83.9.4-.4 48.9v32.3h2.6c3.9-4.5 9.1-8.8 14.4-11.8V58.7L83.9 20l67.2 38.8V76c0 16-13 29.1-28.8 29.3h-.6c-15.7 0-23-6.2-32.3-14.1-10-8.6-21.3-18.3-43.4-18.3h-.7c-25.2.2-45.7 21-45.7 46.3v27l84.3 48.6 84.2-48.6v-31.4h-2.6c-3.7 4.4-9.1 9-14.4 12zM308.5 33.8h17.3v111.9h-17.3v-11.5c-6.6 9.1-15.8 13.6-28 13.6-11 0-20.3-4-28.1-12.2s-11.7-18.2-11.7-29.9c0-11.8 3.8-21.7 11.7-29.9s17.1-12.2 28.1-12.2c12.2 0 21.4 4.5 28 13.4zm-25.3 97.5c7.2 0 13.3-2.4 18.1-7.2 4.8-5 7.2-11 7.2-18.4s-2.4-13.4-7.2-18.2c-4.8-5-10.9-7.4-18.1-7.4s-13.3 2.4-18.1 7.4c-4.8 4.8-7.2 10.9-7.2 18.2 0 7.4 2.4 13.4 7.2 18.4 4.8 4.8 10.9 7.2 18.1 7.2M400.7 65.8h18.4l-30.7 82.5c-7.7 20.6-20.6 30.5-39 29.4v-16.2c10.9.6 17-4.6 21.3-15.7l.8-1.6-33.9-78.5h18.9l23.8 58zM486.2 65.8h18.9l-31.2 80h-20l-31.2-80h18.9l22.4 60.8zM526.6 113.1c2.6 12.2 12.3 18.9 25.6 18.9 9.1 0 16-3.4 20.6-9.9l14.2 8.3c-7.8 11.7-19.5 17.4-35 17.4-13 0-23.5-4-31.5-11.8-8-8-12-18.1-12-30.2 0-12 4-21.9 11.8-29.9 7.8-8.2 18.1-12.2 30.4-12.2 11.7 0 21.3 4.2 28.8 12.3 7.5 8.2 11.4 18.2 11.4 29.9q0 2.7-.6 7.2zM573.4 99c-2.4-13-11.5-19.7-22.9-19.7-12.8 0-21.7 7.5-24.1 19.7zM678 96.6v49.1h-17.3V98.4c0-12-6.9-18.5-17.9-18.5-12.2 0-20.3 7.5-20.3 23v42.9h-17.3v-80h17.3V76c5.3-8.2 13.4-12.3 24.8-12.3 18.4 0 30.7 12.5 30.7 32.9M696.3 50.6c-4.3-4.5-4.3-11.2 0-15.5 4.3-4.5 11.4-4.5 15.7 0 4.3 4.3 4.3 11-.2 15.5-4.3 4.3-11 4.3-15.5 0m-.8 95.1v-80h17.3v80zM795.7 65.8H813v80h-17.3v-11.5c-6.6 9.1-15.8 13.6-28 13.6-11 0-20.3-4-28.1-12.2s-11.7-18.2-11.7-29.9c0-11.8 3.8-21.7 11.7-29.9s17.1-12.2 28.1-12.2c12.2 0 21.4 4.5 28 13.4zm-25.2 65.5c7.2 0 13.3-2.4 18.1-7.2 4.8-5 7.2-11 7.2-18.4s-2.4-13.4-7.2-18.2c-4.8-5-10.9-7.4-18.1-7.4s-13.3 2.4-18.1 7.4c-4.8 4.8-7.2 10.9-7.2 18.2 0 7.4 2.4 13.4 7.2 18.4 4.8 4.8 10.9 7.2 18.1 7.2"></path></svg></span><span class="visually hidden">Dyvenia</span></a><nav id="mainnav" aria-label="Main" class="mainnav"><ul role="list" no-flash class="cluster"><li><a href="/about/">About</a></li><li><a href="/our-process/">Our process</a></li><li class="relative"><button aria-expanded="false" aria-labelledby="mainnav-3" aria-controls="mainnav-3-sub" data-btn-submenu class="nav-sublist-toggle">Learn <svg width="1em" height="1em" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button><ul id="mainnav-3-sub" class="nav-sublist"><li><a href="/blog/" aria-current="page" data-state="active">Blog</a></li><li><a href="/case-studies/">Case Studies</a></li><li><a href="https://github.com/thescalableway/edp-learning">Lessons</a></li></ul></li><li><a href="https://thescalableway.scoreapp.com" target="blank" class="no-indicator plausible-event-name=CTA+Nav">Test Your Scalability</a></li></ul></nav><template id="burger-template"><button type="button" aria-expanded="false" aria-controls="mainnav" data-btn-drawer class="nav-drawer-toggle | cluster"><span>Menu</span> <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg></button></template><script type="module" src="/assets/scripts/components/pagefind-search.js"></script><button id="search-toggle" aria-expanded="false" aria-controls="search-ui" class="search-toggle rounded-full aspect-1 object-cover"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg> <span class="visually-hidden">Search</span></button><pagefind-search id="search-ui" manual _bundle_path="/pagefind/"></pagefind-search><script type="module">const searchToggle = document.querySelector('#search-toggle');
  const searchComponent = document.querySelector('#search-ui');

  const closeSearch = (shouldFocus = false) => {
    searchToggle.setAttribute('aria-expanded', 'false');
    searchComponent.classList.add('hidden');
    if (shouldFocus) {
      searchToggle.focus();
    }
  };

  const openSearch = async () => {
    if (!searchComponent.pagefindUI) {
      const options = {
        pageSize: 10,
        showSubResults: false,
        showImages: false,
        excerptLength: 20,
        resetStyles: false,
        translations: {
          placeholder: 'Search',
          zero_results: "No results found for '[SEARCH_TERM]'."
        }
      };

      console.log('Initializing Pagefind with options:', options);
      await searchComponent.pagefind(options);
    }

    searchToggle.setAttribute('aria-expanded', 'true');
    searchComponent.classList.remove('hidden');
    const searchInput = searchComponent.querySelector('input');
    searchInput?.focus();
  };

  searchToggle.addEventListener('click', async event => {
    event.stopPropagation();
    const expanded = searchToggle.getAttribute('aria-expanded') === 'true';
    if (expanded) {
      closeSearch();
    } else {
      await openSearch();
    }
  });

  document.addEventListener('click', event => {
    if (!searchComponent.contains(event.target) && !searchToggle.contains(event.target)) {
      closeSearch();
    }
  });

  document.addEventListener('keydown', event => {
    if (event.key === 'Escape') {
      closeSearch(true);
    }
  });</script></div></header><main id="main" data-pagefind-body><div class="region blog"><div class="wrapper flow"><h1>How to Setup Data Platform Infrastructure on Google Cloud Platform with Terraform</h1><p class="meta | cluster gutter-xs"><time datetime="2025-03-05T13:31:00.000Z">March 5, 2025 </time><a data-small-button data-ghost-button href="/tags/google-cloud-platform/" class="button">google cloud platform </a><a data-small-button data-ghost-button href="/tags/terraform/" class="button">terraform </a><a data-small-button data-ghost-button href="/tags/data-platform-architecture/" class="button">data platform architecture </a><a data-small-button data-ghost-button href="/tags/prefect/" class="button">prefect </a><a data-small-button data-ghost-button href="/tags/productized-data-platform/" class="button">productized data platform</a></p><p class="meta | cluster gutter-s mt-xl"><a href="/author/karol-wolski/" class="cluster gutter-xs"><picture slot="image"><source type="image/webp" srcset="/assets/images/Karol-100w.webp 100w, /assets/images/Karol-1500w.webp 1500w" sizes="100px"><source type="image/png" srcset="/assets/images/Karol-100w.png 100w, /assets/images/Karol-1500w.png 1500w" sizes="100px"><img src="/assets/images/Karol-1500w.webp" width="1500" height="1250" alt="Karol Wolski" loading="null" decoding="async" eleventy:ignore class="aspect-1 rounded-full object-cover"></picture><span>by Karol Wolski</span></a></p><div class="toc-container | relative"><a href="#toc-skipped" id="skip-toc" class="skip-link">Skip table of contents</a></div><div class="sidebar gutter-s relative flow"><nav id="toc" class="table-of-contents prose"><ol><li class="flow"><a href="#why-choose-a-server-based-approach-with-a-single-vm">Why Choose a Server-Based Approach with a Single VM?</a></li><li class="flow"><a href="#infrastructure-overview">Infrastructure Overview</a><ol><li class="flow"><a href="#understanding-google-cloud-identity-aware-proxy-iap">Understanding Google Cloud Identity-Aware Proxy (IAP)</a></li></ol></li><li class="flow"><a href="#phase-1-securing-the-essentials">Phase 1: Securing the Essentials</a><ol><li class="flow"><a href="#step-1-installing-terraform">Step 1: Installing Terraform</a></li><li class="flow"><a href="#step-2-gcloud-cli-installation">Step 2: gcloud CLI installation</a></li><li class="flow"><a href="#step-3-setting-up-gcp-service-account">Step 3: Setting up GCP Service Account</a></li><li class="flow"><a href="#step-4-downloading-the-json-key-for-the-service-account">Step 4: Downloading the JSON Key for the Service Account</a></li><li class="flow"><a href="#step-5-activating-the-service-account">Step 5: Activating the Service Account</a></li><li class="flow"><a href="#step-6-generating-hmac-key-to-buckets">Step 6: Generating HMAC Key to Buckets</a></li><li class="flow"><a href="#step-7-enabling-compute-engine-api-and-cloud-resource-manager-api">Step 7: Enabling Compute Engine API and Cloud Resource Manager API</a></li><li class="flow"><a href="#step-8-setting-up-a-remote-state-for-terraform">Step 8: Setting Up a Remote State for Terraform</a></li><li class="flow"><a href="#step-9-exporting-credentials-and-setting-up-a-new-bucket">Step 9: Exporting Credentials and Setting up a New Bucket</a></li></ol></li><li class="flow"><a href="#phase-2-installing-and-deploying-infrastructure-with-terraform">Phase 2: Installing &amp; Deploying Infrastructure with Terraform</a><ol><li class="flow"><a href="#terraform-files">Terraform Files</a></li><li class="flow"><a href="#step-1-infrastructure-provisioning-with-terraform">Step 1: Infrastructure Provisioning with Terraform</a></li><li class="flow"><a href="#step-2-set-up-verification">Step 2: Set up Verification</a></li></ol></li><li class="flow"><a href="#conclusion">Conclusion</a></li></ol></nav><p><span id="toc-skipped" class="visually-hidden"></span></p><div class="flow prose"><p></p><p>Setting up a solid, scalable data platform is crucial for organizations looking to get the most out of their data. Building upon our previous discussion on architectural considerations for <a href="https://thescalableway.com/insights/deploying-prefect-on-any-cloud-using-a-single-virtual-machine/" rel="noopener">deploying Prefect on various cloud platforms</a>, this article will walk you through building your data platform infrastructure on Google Cloud Platform (GCP) using Terraform.</p><p>Our focus is on creating a server-based approach utilizing a single Virtual Machine (VM)—a simple yet powerful starting point for organizations that don’t need to dive into complex source systems or full-blown data warehouses just yet. This approach offers an easy entry point with plenty of room to grow as your data needs evolve.</p><p>As this article will use a substantial amount of code, you can find all the relevant code samples in our<a href="https://github.com/thescalableway/dataplatform-gcp-terraform" rel="noopener"> dedicated repository.</a></p><h2 id="why-choose-a-server-based-approach-with-a-single-vm"><a href="#why-choose-a-server-based-approach-with-a-single-vm" class="heading-anchor">Why Choose a Server-Based Approach with a Single VM?</a></h2><p>Choosing a server-based approach with a single VM comes with several advantages:</p><ol class="list"><li><strong>Cost-effectiveness:</strong> A single VM setup is often a more budget-friendly option for initial deployments or smaller-scale projects.</li><li><strong>Simplified management:</strong> Fewer components mean easier maintenance and troubleshooting.</li><li><strong>Flexibility:</strong> This approach offers the ability to easily expand or modify your infrastructure as requirements change.</li><li><strong>Learning curve:</strong> For teams new to cloud infrastructure, starting with a single VM can be less overwhelming and serve as a stepping stone to more complex architectures.</li></ol><p>This guide will walk you through the process of setting up key components of our data platform infrastructure on GCP. You’ll learn how to configure the VPC and subnets, set up Compute Engine instances, configure firewall rules, secure SSH access with Identity-Aware Proxy (IAP), establish internet connectivity with Cloud Router and NAT, and store the state files in Cloud Storage. We’ll also dive into the specifics of GCP’s Identity-Aware Proxy, exploring its crucial role in enhancing the security of our data platform.</p><p>By using Terraform to manage infrastructure as code, we ensure that our setup is reproducible, version-controlled, and easy to manage. This not only streamlines the initial deployment but also makes scaling and future updates much more efficient.</p><p>Let’s get started on building a solid, scalable data platform infrastructure on GCP—one that will grow with your organization’s data needs.</p><h2 id="infrastructure-overview"><a href="#infrastructure-overview" class="heading-anchor">Infrastructure Overview</a></h2><p>Before we dive into the step-by-step process of setting up your data platform on GCP, let’s take a first look at the key components that make up the environment we’ll be building:</p><ul class="list"><li><strong>Virtual Private Cloud (VPC)</strong>: A private network that will serve as the foundation of your environment, providing isolation and security.</li><li><strong>Subnet</strong>: A private subnet where the virtual machine will reside.</li><li><strong>Compute Engine Virtual Machine</strong>: The instance where both the GitHub Runner and Prefect Worker will be set up.</li><li><strong>Firewall</strong>: Configured with rules to allow inbound access exclusively through Google Cloud Identity-Aware Proxy (IAP), blocking all other traffic.</li><li><strong>IAP SSH Permissions</strong>: Enables secure access to the virtual machine.</li><li><strong>Cloud Router</strong>: Provides internet connectivity for the virtual machine.</li><li><strong>Cloud NAT</strong>: Configures a NAT gateway that directs the virtual machine to the Cloud Router for outbound internet access. It also ensures that the public IP is fixed as long as the Cloud NAT object is not destroyed and configured for the same zone.</li><li><strong>Cloud Storage</strong>: Sets up a Google Cloud Storage bucket to store ingested data as Parquet files before transforming and loading it into the database as tables.</li></ul><p><is-land on:idle></is-land></p><dialog class="flow modal21"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/img/ITUd3RhFds-960.webp 960w, /img/ITUd3RhFds-1600.webp 1600w" sizes="auto"><img loading="lazy" decoding="async" src="/img/ITUd3RhFds-960.jpeg" alt="google cloud platform infrastructure" width="1600" height="943" srcset="/img/ITUd3RhFds-960.jpeg 960w, /img/ITUd3RhFds-1600.jpeg 1600w" sizes="auto"></picture></dialog><button data-index="21"><picture><source type="image/webp" srcset="/img/ITUd3RhFds-960.webp 960w, /img/ITUd3RhFds-1600.webp 1600w" sizes="auto"><img loading="lazy" decoding="async" src="/img/ITUd3RhFds-960.jpeg" alt="google cloud platform infrastructure" width="1600" height="943" srcset="/img/ITUd3RhFds-960.jpeg 960w, /img/ITUd3RhFds-1600.jpeg 1600w" sizes="auto"></picture></button><p></p><h3 id="understanding-google-cloud-identity-aware-proxy-iap"><a href="#understanding-google-cloud-identity-aware-proxy-iap" class="heading-anchor">Understanding Google Cloud Identity-Aware Proxy (IAP)</a></h3><p>To ensure a secure environment, all public access should be completely blocked. With this configuration, resources within the environment can be accessed using two main options:</p><ul class="list"><li><strong>VPN Connection</strong>: In this setup, at least one resource within the VPC must be exposed to the internet to host a VPN endpoint. Alternatively, a separate VPC can be configured solely for VPN purposes, with VPC Network Peering into the main environment. This way, only the VPN-hosting VPC is exposed to the internet, while the main environment remains accessible only internally. Although effective, this configuration is more complex and falls outside the scope of this documentation.</li><li><strong>Google Cloud Identity-Aware Proxy (IAP)</strong>: This option offers a similar secure access model to a VPN but with simplified management through Google Cloud. As outlined in the <a href="https://cloud.google.com/iap/docs/concepts-overview#how_iap_works" rel="noopener">official documentation</a>:</li></ul><blockquote><p><em>“When an application or resource is protected by IAP, it can only be accessed through the proxy by principals, also known as users, who have the correct Identity and Access Management (IAM) role. When you grant a user access to an application or resource by IAP, they’re subject to the fine-grained access controls implemented by the product in use without requiring a VPN. When a user tries to access an IAP-secured resource, IAP performs authentication and authorization checks.”</em></p></blockquote><p>This <a href="https://cloud.google.com/iap/images/iap-load-balancer.png" rel="noopener">diagram from Google</a> further illustrates the components required to implement this configuration:</p><p><is-land on:idle></is-land></p><dialog class="flow modal22"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/img/2CFZG6gV0g-960.webp 960w, /img/2CFZG6gV0g-1600.webp 1600w" sizes="auto"><img loading="lazy" decoding="async" src="/img/2CFZG6gV0g-960.jpeg" alt="google configuration diagram" width="1600" height="1257" srcset="/img/2CFZG6gV0g-960.jpeg 960w, /img/2CFZG6gV0g-1600.jpeg 1600w" sizes="auto"></picture></dialog><button data-index="22"><picture><source type="image/webp" srcset="/img/2CFZG6gV0g-960.webp 960w, /img/2CFZG6gV0g-1600.webp 1600w" sizes="auto"><img loading="lazy" decoding="async" src="/img/2CFZG6gV0g-960.jpeg" alt="google configuration diagram" width="1600" height="1257" srcset="/img/2CFZG6gV0g-960.jpeg 960w, /img/2CFZG6gV0g-1600.jpeg 1600w" sizes="auto"></picture></button><p></p><p>With a solid understanding of Google Cloud Identity and its role in managing users and access, let’s now dive into the practical steps for setting it up and implementing it effectively.</p><h2 id="phase-1-securing-the-essentials"><a href="#phase-1-securing-the-essentials" class="heading-anchor">Phase 1: Securing the Essentials</a></h2><p>Before starting the Terraform configuration, make sure you have the following tools and setups in place:</p><ul class="list"><li><strong>Terraform</strong>: You’ll need Terraform installed on your local machine. This will be your main tool for provisioning infrastructure.</li><li><strong>gcloud CLI</strong>: The gcloud CLI tool should be installed and configured to interact with your Google Cloud account.</li><li><strong>GCP Service Account</strong>: A Google Cloud Platform service account needs to be created.</li><li><strong>Enabled APIs</strong>: Make sure the Compute Engine API and Cloud Resource Manager API are enabled on your GCP account.</li></ul><p>Let’s take a detailed look at these prerequisites:</p><h3 id="step-1-installing-terraform"><a href="#step-1-installing-terraform" class="heading-anchor">Step 1: Installing Terraform</a></h3><p>Terraform can be installed in various ways, which are outlined <a href="https://developer.hashicorp.com/terraform/install" rel="noopener">by Hashicorp here</a>. For Ubuntu, installation can be done with the following commands:</p><pre class="language-bash"><code class="language-bash"><span class="token function">wget</span> <span class="token parameter variable">-O</span> - https://apt.releases.hashicorp.com/gpg <span class="token operator">|</span> <span class="token function">sudo</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token parameter variable">-o</span>
/usr/share/keyrings/hashicorp-archive-keyring.gpg
<span class="token builtin class-name">echo</span> <span class="token string">"deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg]
https://apt.releases.hashicorp.com <span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">)</span></span> main"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span>
/etc/apt/sources.list.d/hashicorp.list
<span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> terraform</code></pre><h3 id="step-2-gcloud-cli-installation"><a href="#step-2-gcloud-cli-installation" class="heading-anchor">Step 2: gcloud CLI installation</a></h3><p>Similarly to Terraform, the gcloud CLI can be installed as per the <a href="https://cloud.google.com/sdk/docs/install" rel="noopener">official instructions</a>. For Ubuntu, run:</p><pre class="language-bash"><code class="language-bash"> 
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> apt-transport-https ca-certificates gnupg <span class="token function">curl</span>
<span class="token function">curl</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="token operator">|</span> <span class="token function">sudo</span> gpg <span class="token parameter variable">--dearmor</span>
<span class="token parameter variable">-o</span> /usr/share/keyrings/cloud.google.gpg
<span class="token builtin class-name">echo</span> <span class="token string">"deb [signed-by=/usr/share/keyrings/cloud.google.gpg]
https://packages.cloud.google.com/apt cloud-sdk main"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span>
/etc/apt/sources.list.d/google-cloud-sdk.list
<span class="token function">sudo</span> <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> google-cloud-cli</code></pre><p>After installation, initialize the gcloud CLI by providing the “gcloud init” command and setting up a new account by opening the provided URL.</p><pre class="language-bash"><code class="language-bash">gcloud init


<span class="token comment"># gcloud init</span>
Welcome<span class="token operator">!</span> This <span class="token builtin class-name">command</span> will take you through the configuration of gcloud.

Your current configuration has been <span class="token builtin class-name">set</span> to: <span class="token punctuation">[</span>default<span class="token punctuation">]</span>

You can skip diagnostics next <span class="token function">time</span> by using the following flag:
  gcloud init --skip-diagnostics

Network diagnostic detects and fixes <span class="token builtin class-name">local</span> network connection issues.
Checking network connection<span class="token punctuation">..</span>.done.
Reachability Check passed.
Network diagnostic passed <span class="token punctuation">(</span><span class="token number">1</span>/1 checks passed<span class="token punctuation">)</span>.

You must sign <span class="token keyword">in</span> to continue. Would you like to sign <span class="token keyword">in</span> <span class="token punctuation">(</span>Y/n<span class="token punctuation">)</span>?  Y

Go to the following <span class="token function">link</span> <span class="token keyword">in</span> your browser, and complete the sign-in prompts:

    https://accounts.google.com/o/oauth2/auth<span class="token operator">&lt;</span>URL_TO_OPEN_IN_BROWSER<span class="token operator">&gt;</span>

Once finished, enter the verification code provided <span class="token keyword">in</span> your browser:
<span class="token operator">&lt;</span>PROVIDE_VERIFICATION_CODE<span class="token operator">&gt;</span></code></pre><p>Subsequently, configure the desired Cloud project, default Compute Region, and Zone for your environment.</p><h3 id="step-3-setting-up-gcp-service-account"><a href="#step-3-setting-up-gcp-service-account" class="heading-anchor">Step 3: Setting up GCP Service Account</a></h3><p>To create a GCP Service Account, navigate to the <a href="https://console.cloud.google.com/" rel="noopener">Google Cloud Console</a>, select the correct project, and go to <code>Navigation Menu (3 lines) &gt; IAM &amp; Admin &gt; Service Accounts.</code></p><p><is-land on:idle></is-land></p><dialog class="flow modal23"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/0OGIJK8OA6-487.webp 487w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/0OGIJK8OA6-487.jpeg" alt="how to set up a google cloud platform service account" width="487" height="326"></picture></dialog><button data-index="23"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/0OGIJK8OA6-487.webp 487w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/0OGIJK8OA6-487.jpeg" alt="how to set up a google cloud platform service account" width="487" height="326"></picture></button><p></p><p>Click <code>Create Service Account</code> and provide the required information.</p><p><is-land on:idle></is-land></p><dialog class="flow modal24"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/cg275sFJs--552.webp 552w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/cg275sFJs--552.jpeg" alt="how to create service account on goocle cloud platform" width="552" height="532"></picture></dialog><button data-index="24"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/cg275sFJs--552.webp 552w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/cg275sFJs--552.jpeg" alt="how to create service account on goocle cloud platform" width="552" height="532"></picture></button><p></p><p>When prompted to <strong>Grant this service account access to a project</strong>, select the appropriate role. In this guide, we use the <strong>Owner</strong> role for simplicity, but it’s advisable to limit permissions to only what’s necessary.</p><p>Finally, in the <strong>Grant users access to this service account</strong> step, assign access to the users who will need to interact with the Kubernetes cluster (not part of this article) or VM. Once done, verify that the service account is correctly set up. Its email should follow this pattern:</p><p><code>{service_account_name}@{project}.iam.gserviceaccount.com</code></p><h3 id="step-4-downloading-the-json-key-for-the-service-account"><a href="#step-4-downloading-the-json-key-for-the-service-account" class="heading-anchor">Step 4: Downloading the JSON Key for the Service Account</a></h3><p>In the service account interface, go to <code>Actions (3 dots) &gt; Manage keys</code>.</p><p><is-land on:idle></is-land></p><dialog class="flow modal25"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/JG7MD0ilyl-742.webp 742w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/JG7MD0ilyl-742.jpeg" alt="how to set up json key in google cloud platform" width="742" height="339"></picture></dialog><button data-index="25"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/JG7MD0ilyl-742.webp 742w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/JG7MD0ilyl-742.jpeg" alt="how to set up json key in google cloud platform" width="742" height="339"></picture></button><p></p><p>Select <code>Add Key &gt; Create new key &gt; JSON</code> to download the JSON key file. Keep this file secure, as it will be required for Terraform configuration.</p><h3 id="step-5-activating-the-service-account"><a href="#step-5-activating-the-service-account" class="heading-anchor">Step 5: Activating the Service Account</a></h3><p>After downloading the JSON key, activate the service account locally with the following command:</p><pre class="language-bash"><code class="language-bash">gcloud auth activate-service-account
<span class="token punctuation">{</span>service_account_name<span class="token punctuation">}</span>@<span class="token punctuation">{</span>project<span class="token punctuation">}</span>.iam.gserviceaccount.com
--key-file<span class="token operator">=</span><span class="token punctuation">{</span>json_file<span class="token punctuation">}</span>.json</code></pre><p>This step enables the service account for use in the local environment, ensuring access to necessary GCP resources with IAP tunnel functionality.</p><h3 id="step-6-generating-hmac-key-to-buckets"><a href="#step-6-generating-hmac-key-to-buckets" class="heading-anchor">Step 6: Generating HMAC Key to Buckets</a></h3><p>To enable file uploads to Cloud Storage, some libraries require an HMAC token in addition to a JSON key. To generate an HMAC token:</p><ul class="list"><li>Go to <code>Cloud Storage &gt; Settings &gt; Interoperability</code>.</li><li>Under <code>Service account HMAC</code>, click <code>Create a key for service account</code>.</li><li>Once created, the token will be marked as ‘Active’.</li></ul><p><is-land on:idle></is-land></p><dialog class="flow modal26"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/eXA4O9qWt9-479.webp 479w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/eXA4O9qWt9-479.jpeg" alt="how to generate HMAC key in google cloud platform" width="479" height="392"></picture></dialog><button data-index="26"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/eXA4O9qWt9-479.webp 479w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/eXA4O9qWt9-479.jpeg" alt="how to generate HMAC key in google cloud platform" width="479" height="392"></picture></button><p></p><p>For basic configuration, this step is not required. However, for ingestion, the key must be added to Google Secret Manager to ensure it’s accessible for flow runs.</p><h3 id="step-7-enabling-compute-engine-api-and-cloud-resource-manager-api"><a href="#step-7-enabling-compute-engine-api-and-cloud-resource-manager-api" class="heading-anchor">Step 7: Enabling Compute Engine API and Cloud Resource Manager API</a></h3><p>Before Terraform can interact with GCP, make sure these APIs are enabled for your project:</p><ul class="list"><li><a href="https://console.cloud.google.com/marketplace/product/google/compute.googleapis.com" rel="noopener">Compute Engine API</a></li><li><a href="https://console.cloud.google.com/marketplace/product/google/cloudresourcemanager.googleapis.com" rel="noopener">Cloud Resource Manager API</a></li><li><a href="https://console.cloud.google.com/marketplace/product/google-cloud-platform/cloud-storage" rel="noopener">Cloud Storage</a></li></ul><p>If they’re not enabled, head to the Google Cloud Console and enable them.</p><h3 id="step-8-setting-up-a-remote-state-for-terraform"><a href="#step-8-setting-up-a-remote-state-for-terraform" class="heading-anchor">Step 8: Setting Up a Remote State for Terraform</a></h3><p>By default, Terraform stores its state locally in .tfstate files. While this works for development, for any persistent environment, even if you’re the only one working on the project, it’s crucial to store this state in a centralized and reliable location. A common best practice is to use a Google Cloud Storage (GCS) bucket to keep the state safe and accessible, avoiding potential issues with local file loss or conflicts.</p><p>However, Terraform itself cannot create the bucket required for storing its state, leading to what’s called a “chicken-and-egg” problem. The bucket must be created manually before running any Terraform code. Tools like Terragrunt can solve this by simplifying environment management and reducing code duplication <a href="https://blog.alterway.fr/en/manage-multiple-kubernetes-clusters-on-gke-with-terragrunt.html" rel="noopener">(example setup)</a>. However, for the sake of simplicity, we are not introducing such tools in this context.</p><p>To create a new bucket using the <code>gcloud CLI</code>, export the necessary credentials and then proceed with the bucket creation process.</p><h3 id="step-9-exporting-credentials-and-setting-up-a-new-bucket"><a href="#step-9-exporting-credentials-and-setting-up-a-new-bucket" class="heading-anchor">Step 9: Exporting Credentials and Setting up a New Bucket</a></h3><p>Once we have our service account JSON prepared, an export of credentials is necessary to provide Application Default Credentials (ADC):</p><p><code>export GOOGLE_APPLICATION_CREDENTIALS=test-project-32206692d146.json</code></p><p>Then, with the usage of gcloud CLI, a new bucket with the applied policy should be created:</p><pre class="language-bash"><code class="language-bash">gcloud storage buckets create gs://test-project-tfstate <span class="token parameter variable">--location</span><span class="token operator">=</span>us-central1 
--uniform-bucket-level-access

gcloud storage buckets add-iam-policy-binding gs://test-project-tfstate <span class="token punctuation">\</span>
<span class="token parameter variable">--member</span><span class="token operator">=</span><span class="token string">"serviceAccount:test-service-account@test-project.iam.gserviceaccount.com"</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--role</span><span class="token operator">=</span><span class="token string">"roles/storage.objectAdmin"</span></code></pre><p>Once completed, it should be available in the GCP Console. To check it, go to <code>Navigation Menu &gt; Cloud Storage &gt; Buckets</code>:</p><p><is-land on:idle></is-land></p><dialog class="flow modal27"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/DwEN8YF8e3-960.webp 960w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/DwEN8YF8e3-960.jpeg" alt="how to set up a new bucket on google cloud platform" width="960" height="133"></picture></dialog><button data-index="27"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/DwEN8YF8e3-960.webp 960w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/DwEN8YF8e3-960.jpeg" alt="how to set up a new bucket on google cloud platform" width="960" height="133"></picture></button><p></p><h2 id="phase-2-installing-and-deploying-infrastructure-with-terraform"><a href="#phase-2-installing-and-deploying-infrastructure-with-terraform" class="heading-anchor">Phase 2: Installing &amp; Deploying Infrastructure with Terraform</a></h2><p>To set up the environment, Terraform will handle provisioning all the required GCP resources. By the end of this process, your directory structure will look like this:</p><pre class="language-bash"><code class="language-bash">$ tree

<span class="token operator">|</span>-- backend.tf
<span class="token operator">|</span>-- main.tf
<span class="token operator">|</span>-- provider.tf
<span class="token operator">|</span>-- test-project-32206692d146.json
<span class="token operator">|</span>-- variable.tf</code></pre><p>For managing both DEV and PROD environments, you can duplicate the files as shown:</p><pre class="language-bash"><code class="language-bash">$ tree
├── dev
    ├── backend.tf
│   ├── main.tf
│   ├── test-project-32206692d146.json
│   ├── provider.tf
│   └── variable.tf
└── prod
    ├── backend.tf
    ├── main.tf
    ├── test-project-32206692d146.json
    ├── provider.tf
    └── variable.tf</code></pre><h4 id="terraform-files"><a href="#terraform-files" class="heading-anchor">Terraform Files</a></h4><p>The main difference between environments lies in the <code>backend.tf</code> and <code>variables.tf</code> files. In larger projects, using Terraform modules or tools like Terragrunt is recommended for reusable configurations. However, for simplicity, this example uses code duplication, which is also a valid approach.</p><p>The content of <code>provider.tf</code> should look like this:</p><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">provider<span class="token type variable"> "google" </span></span><span class="token punctuation">{</span>
  <span class="token property">region</span>      <span class="token punctuation">=</span> var.region
  <span class="token property">project</span>     <span class="token punctuation">=</span> var.project_name
  <span class="token property">credentials</span> <span class="token punctuation">=</span> file(var.credentials_file)
  <span class="token property">zone</span>        <span class="token punctuation">=</span> var.zone
<span class="token punctuation">}</span></code></pre><p><code>backend.tf</code> should point to a bucket with a shared tfstate file created in step 9 of the first phase. It needs to be manually configured because it is the first block loaded when running <code>terraform init</code>, and variables from <code>variables.tf</code> cannot be referenced here:</p><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
  <span class="token keyword">backend<span class="token type variable"> "gcs" </span></span><span class="token punctuation">{</span>
    <span class="token property">bucket</span>  <span class="token punctuation">=</span> <span class="token string">"test-project-tfstate"</span>
    <span class="token property">prefix</span>  <span class="token punctuation">=</span> <span class="token string">"terraform/state/prod"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>All variables used in <code>provider.tf</code> and <code>main.tf</code> are defined in <code>variable.tf</code>, as shown below:</p><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "credentials_file" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"test-project-32206692d146.json"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "environment" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"prod"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "filesystem" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"ext4"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "image" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> 
<span class="token string">"projects/ubuntu-os-cloud/global/images/ubuntu-2404-noble-amd64-v20241115"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ip_cidr_range" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"10.202.0.0/24"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "machine_type" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"c3d-standard-8-lssd"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "project_name" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"test-project"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "region" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"us-central1"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "service_account" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> 
<span class="token string">"serviceAccount:test-service-account@test-project.iam.gserviceaccount.com"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "zone" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"us-central1-c"</span>
<span class="token punctuation">}</span></code></pre><p><code>main.tf</code> defines and initializes all infrastructure components outlined in the <a href="#infrastructure-overview">Infrastructure overview section</a>.</p><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">resource <span class="token type variable">"google_compute_network"</span></span> <span class="token string">"vpc_edp"</span> <span class="token punctuation">{</span>
 <span class="token property">name</span>                    <span class="token punctuation">=</span> <span class="token string">"vpc-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>"</span>
 <span class="token property">auto_create_subnetworks</span> <span class="token punctuation">=</span> <span class="token string">"false"</span>

<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"google_compute_subnetwork"</span></span> <span class="token string">"subnet_edp"</span> <span class="token punctuation">{</span>
 <span class="token property">name</span>          <span class="token punctuation">=</span> <span class="token string">"subnet-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>"</span>
 <span class="token property">ip_cidr_range</span> <span class="token punctuation">=</span> var.ip_cidr_range
 <span class="token property">network</span>       <span class="token punctuation">=</span> google_compute_network.vpc_edp.name
 <span class="token property">region</span>        <span class="token punctuation">=</span> var.region
 <span class="token property">depends_on</span>    <span class="token punctuation">=</span> <span class="token punctuation">[</span>google_compute_network.vpc_edp<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"google_compute_instance"</span></span> <span class="token string">"vm_edp"</span> <span class="token punctuation">{</span>
 <span class="token property">project</span>      <span class="token punctuation">=</span> var.project_name
 <span class="token property">zone</span>         <span class="token punctuation">=</span> var.zone
 <span class="token property">name</span>         <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>-01"</span>
 <span class="token property">machine_type</span> <span class="token punctuation">=</span> var.machine_type
 <span class="token keyword">boot_disk</span> <span class="token punctuation">{</span>
   <span class="token property">auto_delete</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
   <span class="token keyword">initialize_params</span> <span class="token punctuation">{</span>
     <span class="token property">image</span> <span class="token punctuation">=</span> var.image
     <span class="token property">size</span>  <span class="token punctuation">=</span> <span class="token number">50</span>
     <span class="token property">type</span>  <span class="token punctuation">=</span> <span class="token string">"pd-ssd"</span>
   <span class="token punctuation">}</span>
   <span class="token property">mode</span> <span class="token punctuation">=</span> <span class="token string">"READ_WRITE"</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">scratch_disk</span> <span class="token punctuation">{</span>
   <span class="token property">interface</span> <span class="token punctuation">=</span> <span class="token string">"NVME"</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">network_interface</span> <span class="token punctuation">{</span>
   <span class="token property">network</span>    <span class="token punctuation">=</span> <span class="token string">"vpc-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>"</span>
   <span class="token property">subnetwork</span> <span class="token punctuation">=</span> google_compute_subnetwork.subnet_edp.name
 <span class="token punctuation">}</span>
 <span class="token property">metadata_startup_script</span> <span class="token punctuation">=</span> <span class="token heredoc string">&lt;&lt;-EOT
   #!/bin/bash
   set -e
   sudo mkfs.ext4 -F /dev/disk/by-id/google-local-nvme-ssd-0
   sudo mkdir -p /mnt/disks/local-nvme-ssd
   sudo mount /dev/disk/by-id/google-local-nvme-ssd-0 /mnt/disks/local-nvme-ssd
   sudo chmod a+w /mnt/disks/local-nvme-ssd

   echo UUID=`sudo blkid -s UUID -o value /dev/disk/by-id/google-local-nvme-ssd-0` /mnt/disks/local-nvme-ssd ext4 discard,defaults,nofail 0 2 | sudo tee -a /etc/fstab
 EOT</span>
 <span class="token property">depends_on</span>              <span class="token punctuation">=</span> <span class="token punctuation">[</span>google_compute_network.vpc_edp<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"google_compute_firewall"</span></span> <span class="token string">"rules"</span> <span class="token punctuation">{</span>
 <span class="token property">project</span> <span class="token punctuation">=</span> var.project_name
 <span class="token property">name</span>    <span class="token punctuation">=</span> <span class="token string">"allow-ssh-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>"</span>
 <span class="token property">network</span> <span class="token punctuation">=</span> <span class="token string">"vpc-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>"</span>

 <span class="token keyword">allow</span> <span class="token punctuation">{</span>
   <span class="token property">protocol</span> <span class="token punctuation">=</span> <span class="token string">"tcp"</span>
   <span class="token property">ports</span>    <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"22"</span>, <span class="token string">"6443"</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
 <span class="token property">source_ranges</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"35.235.240.0/20"</span><span class="token punctuation">]</span>
 <span class="token property">depends_on</span>    <span class="token punctuation">=</span> <span class="token punctuation">[</span>google_compute_network.vpc_edp<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"google_project_iam_member"</span></span> <span class="token string">"project"</span> <span class="token punctuation">{</span>
 <span class="token property">project</span> <span class="token punctuation">=</span> var.project_name
 <span class="token property">role</span>    <span class="token punctuation">=</span> <span class="token string">"roles/iap.tunnelResourceAccessor"</span>
 <span class="token property">member</span>  <span class="token punctuation">=</span> var.service_account
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"google_compute_router"</span></span> <span class="token string">"router"</span> <span class="token punctuation">{</span>
 <span class="token property">project</span>    <span class="token punctuation">=</span> var.project_name
 <span class="token property">name</span>       <span class="token punctuation">=</span> <span class="token string">"nat-router-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>"</span>
 <span class="token property">network</span>    <span class="token punctuation">=</span> <span class="token string">"vpc-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>"</span>
 <span class="token property">region</span>     <span class="token punctuation">=</span> var.region
 <span class="token property">depends_on</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>google_compute_network.vpc_edp<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"google_compute_router_nat"</span></span> <span class="token string">"nat"</span> <span class="token punctuation">{</span>
 <span class="token property">name</span>                               <span class="token punctuation">=</span> <span class="token string">"router-nat-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>"</span>
 <span class="token property">router</span>                             <span class="token punctuation">=</span> google_compute_router.router.name
 <span class="token property">region</span>                             <span class="token punctuation">=</span> var.region
 <span class="token property">nat_ip_allocate_option</span>             <span class="token punctuation">=</span> <span class="token string">"AUTO_ONLY"</span>
 <span class="token property">source_subnetwork_ip_ranges_to_nat</span> <span class="token punctuation">=</span> <span class="token string">"ALL_SUBNETWORKS_ALL_IP_RANGES"</span>

 <span class="token keyword">log_config</span> <span class="token punctuation">{</span>
   <span class="token property">enable</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
   <span class="token property">filter</span> <span class="token punctuation">=</span> <span class="token string">"ERRORS_ONLY"</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"google_storage_bucket"</span></span> <span class="token string">"private_bucket"</span> <span class="token punctuation">{</span>
 <span class="token property">name</span>          <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">environment</span><span class="token punctuation">}</span></span>"</span>
 <span class="token property">location</span>      <span class="token punctuation">=</span> var.region
 <span class="token property">storage_class</span> <span class="token punctuation">=</span> <span class="token string">"STANDARD"</span>

 <span class="token property">uniform_bucket_level_access</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"google_storage_bucket_iam_binding"</span></span> <span class="token string">"bucket_writer"</span> <span class="token punctuation">{</span>
 <span class="token property">bucket</span> <span class="token punctuation">=</span> google_storage_bucket.private_bucket.name

 <span class="token property">role</span> <span class="token punctuation">=</span> <span class="token string">"roles/storage.objectCreator"</span>
 <span class="token property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
   <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">service_account</span><span class="token punctuation">}</span></span>"</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"google_storage_bucket_iam_binding"</span></span> <span class="token string">"bucket_admin"</span> <span class="token punctuation">{</span>
 <span class="token property">bucket</span> <span class="token punctuation">=</span> google_storage_bucket.private_bucket.name

 <span class="token property">role</span> <span class="token punctuation">=</span> <span class="token string">"roles/storage.admin"</span>
 <span class="token property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
   <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">service_account</span><span class="token punctuation">}</span></span>"</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><p>With the environment outlined, let’s provision the infrastructure by validating, formatting, and applying the configuration.</p><h3 id="step-1-infrastructure-provisioning-with-terraform"><a href="#step-1-infrastructure-provisioning-with-terraform" class="heading-anchor">Step 1: Infrastructure Provisioning with Terraform</a></h3><p>Once the necessary files are prepared, validate and format the configuration:</p><pre class="language-bash"><code class="language-bash">$ terraform validate
Success<span class="token operator">!</span> The configuration is valid.
$ terraform <span class="token function">fmt</span>
main.tf
provider.tf</code></pre><p>Before applying changes, inspect them with the <code>plan</code> command:</p><pre class="language-bash"><code class="language-bash">terraform plan
<span class="token comment"># Check if it's all good</span>
terraform apply
<span class="token comment"># Enter a value: yes</span></code></pre><p>After a few minutes, the environment will be ready. To list the created resources, run:</p><pre class="language-bash"><code class="language-bash">$ terraform state list
google_compute_firewall.rules
google_compute_instance.vm_edp
google_compute_network.vpc_edp
google_compute_router.router
google_compute_router_nat.nat
google_compute_subnetwork.subnet_edp
google_project_iam_member.project</code></pre><h3 id="step-2-set-up-verification"><a href="#step-2-set-up-verification" class="heading-anchor">Step 2: Set up Verification</a></h3><p>Verify the resources by logging into the GCP Console. Confirm the creation of <strong>VPC and Subnet, Virtual Machine, Firewall Rule, IAP SSH Permission, Cloud Router, and NAT Gateway</strong>. Navigate to the following sections:</p><ul class="list"><li><strong>VPC and Subnet</strong></li></ul><p>Go to <code>Navigation Menu &gt; VPC Network &gt; VPC Networks</code>:</p><p><is-land on:idle></is-land></p><dialog class="flow modal28"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-960.webp 960w, /blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-1219.webp 1219w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-960.jpeg" alt="how to verify set up on google cloud platform with VPC" width="1219" height="144" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-960.jpeg 960w, /blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-1219.jpeg 1219w" sizes="auto"></picture></dialog><button data-index="28"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-960.webp 960w, /blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-1219.webp 1219w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-960.jpeg" alt="how to verify set up on google cloud platform with VPC" width="1219" height="144" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-960.jpeg 960w, /blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/fTt7wxmNGG-1219.jpeg 1219w" sizes="auto"></picture></button><p></p><p>Click on the VPC and check the <code>Subnets</code> tab:</p><p><is-land on:idle></is-land></p><dialog class="flow modal29"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/enz5i7h6Ld-960.webp 960w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/enz5i7h6Ld-960.jpeg" alt="verifying google cloud platform setupn on VPC" width="960" height="207"></picture></dialog><button data-index="29"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/enz5i7h6Ld-960.webp 960w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/enz5i7h6Ld-960.jpeg" alt="verifying google cloud platform setupn on VPC" width="960" height="207"></picture></button><p></p><ul class="list"><li><strong>Virtual Machine</strong></li></ul><p>Navigate to <code>Navigation Menu &gt; Compute Engine &gt; VM instances</code>:</p><p><is-land on:idle></is-land></p><dialog class="flow modal30"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/Rz29rknMsr-960.webp 960w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/Rz29rknMsr-960.jpeg" alt="how to verify set up on google cloud platform on VM" width="960" height="126"></picture></dialog><button data-index="30"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/Rz29rknMsr-960.webp 960w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/Rz29rknMsr-960.jpeg" alt="how to verify set up on google cloud platform on VM" width="960" height="126"></picture></button><p></p><ul class="list"><li><strong>Firewall Rule</strong></li></ul><p>Go to <code>Navigation Menu &gt; VPC Network &gt; Firewall</code>:</p><p><is-land on:idle></is-land></p><dialog class="flow modal31"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/ptoJB2fUhV-960.webp 960w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/ptoJB2fUhV-960.jpeg" alt="how to verify set up on google cloud platform with Firewall rule" width="960" height="343"></picture></dialog><button data-index="31"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/ptoJB2fUhV-960.webp 960w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/ptoJB2fUhV-960.jpeg" alt="how to verify set up on google cloud platform with Firewall rule" width="960" height="343"></picture></button><p></p><ul class="list"><li><strong>IAM Role</strong></li></ul><p>Navigate to <code>Navigation Menu &gt; IAM &amp; Admin &gt; IAM</code>, and <code>View by roles</code>:</p><p><is-land on:idle></is-land></p><dialog class="flow modal32"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/UQrnGOluqb-871.webp 871w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/UQrnGOluqb-871.jpeg" alt="how to verify set up on google cloud platform with IAM role" width="871" height="272"></picture></dialog><button data-index="32"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/UQrnGOluqb-871.webp 871w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/UQrnGOluqb-871.jpeg" alt="how to verify set up on google cloud platform with IAM role" width="871" height="272"></picture></button><p></p><ul class="list"><li><strong>Cloud NAT gateway</strong></li></ul><p>Go to <code>Navigation Menu &gt; Network Connectivity &gt; Cloud Routers &gt; Open Cloud Router</code>:</p><p><is-land on:idle></is-land></p><dialog class="flow modal33"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/akM5MKhm_V-421.webp 421w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/akM5MKhm_V-421.jpeg" alt="how to verify set up on google cloud platform with Cloud NAT gateway" width="421" height="105"></picture></dialog><button data-index="33"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/akM5MKhm_V-421.webp 421w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/akM5MKhm_V-421.jpeg" alt="how to verify set up on google cloud platform with Cloud NAT gateway" width="421" height="105"></picture></button><p></p><ul class="list"><li><strong>Cloud NAT</strong></li></ul><p>Navigate to <code>Navigation Menu &gt; Network Services &gt; Cloud NAT</code>:</p><p><is-land on:idle></is-land></p><dialog class="flow modal34"><button autofocus class="button">Close</button><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/DPj09xSoyH-863.webp 863w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/DPj09xSoyH-863.jpeg" alt="how to verify set up on google cloud platform with Cloud NAT" width="863" height="107"></picture></dialog><button data-index="34"><picture><source type="image/webp" srcset="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/DPj09xSoyH-863.webp 863w" sizes="auto"><img loading="lazy" decoding="async" src="/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/DPj09xSoyH-863.jpeg" alt="how to verify set up on google cloud platform with Cloud NAT" width="863" height="107"></picture></button><p></p><ul class="list"><li><strong>SSH Access to Virtual Machine using GCP Console</strong></li></ul><p>To test SSH connectivity to the Virtual Machine, go to <code>Navigation Menu &gt; Compute Engine &gt; VM instances</code> and click on the SSH option for the created VM. Approve the connection when prompted, and you should be logged in.</p><p>This verification ensures all components are correctly configured and accessible. The next steps in setting up the data platform should be setting up a self-hosted GitHub runner and then a Prefect worker.</p><ul class="list"><li><strong>SSH Access to Virtual Machine Using the gcloud CLI</strong></li></ul><p>You can access a Virtual Vachine securely using only a service account token and gcloud CLI. Follow these steps to set up and establish SSH access:</p><ul class="list"><li>Ensure you have the service account JSON key stored locally.</li><li>Log in to your Google Cloud account using the following command:</li></ul><pre class="language-bash"><code class="language-bash">gcloud auth activate-service-account 
test-service-account@test-project.iam.gserviceaccount.com --key-file
 ~/.config/gcloud.json
gcloud config <span class="token builtin class-name">set</span> project test-project</code></pre><p>Once authenticated, execute the following command to initiate the SSH connection:</p><pre class="language-bash"><code class="language-bash">gcloud compute <span class="token function">ssh</span> <span class="token variable">${project_name}</span>-<span class="token variable">${environment}</span>-01</code></pre><p>On the first execution, the gcloud CLI will prompt you to generate a private and public SSH key pair. Follow the instructions to create the key pair.</p><p>Once the keys are created, access to the virtual machine will be automatically established. Subsequent logins will reuse the existing key pair, simplifying future access.</p><h2 id="conclusion"><a href="#conclusion" class="heading-anchor">Conclusion</a></h2><p>Setting up a data platform infrastructure on Google Cloud Platform using Terraform provides a solid foundation for organizations looking to leverage the power of their data. This approach offers several key benefits:</p><ul class="list"><li>Scalability and Flexibility: The server-based approach with a single VM provides an excellent starting point that can easily be expanded as your data needs grow.</li><li>Security: By leveraging Google Cloud’s Identity-Aware Proxy (IAP), we’ve ensured that access to our resources is tightly controlled and secure.</li><li>Infrastructure as Code: Using Terraform allows for version-controlled, reproducible infrastructure deployments, making it easier to manage and update your environment over time.</li><li>Cost-Effectiveness: Starting with a single VM setup is often more budget-friendly for initial deployments or smaller-scale projects.</li><li>Simplified Management: With fewer components to manage initially, maintenance and troubleshooting become more straightforward.</li></ul><p>By following the steps outlined in this guide, you’ve created a robust infrastructure that includes a VPC, subnet, Compute Engine instance, firewall rules, IAP SSH permissions, Cloud Router, Cloud NAT, and Cloud Storage. This setup provides a solid base for running a data platform, including components like a GitHub Runner and Prefect Worker. The process of setting up these additional components will be covered in the next article of this series, building upon the foundation we’ve established here.</p><p>Our <a href="https://github.com/thescalableway/dataplatform-gcp-terraform" rel="noopener">dedicated repository</a> contains all code examples and implementations discussed in this article, which can be accessed for reference and further exploration. We encourage you to review the repository for a comprehensive understanding of the concepts presented.</p><p>Remember, while this guide provides a strong starting point, it’s crucial to continually assess and adjust your infrastructure to meet your organization’s changing needs and to stay aligned with best practices in cloud computing and data management.</p></div></div><div class="sidebar sidebar-newsletter gutter-lg relative mt-xl-2xl"><div></div><aside class="newsletter | flow"><h3>Subscribe to our Newsletter</h3><form data-hubspot class="flow"><label class="form-control gutter-xs text-step-min-1"><input type="checkbox" name="consent" required><p>I would like to receive the newsletter. I can revoke this consent at any time by using the unsubscribe link provided in all communications. For more information, please review our <a href="/privacy">Privacy Policy</a>.</p></label><div class="flow gutter-xs"><div class="cluster gutter-xs"><div><label class="visually-hidden">First Name</label> <input type="text" name="firstname" autocomplete="given-name" placeholder="First Name" required></div><div><label class="visually-hidden">Last Name</label> <input type="text" name="lastname" autocomplete="family-name" placeholder="Last Name" required></div><div class="flow-space-s"><label class="visually-hidden">Company Name</label> <input type="text" name="company" autocomplete="organization" placeholder="Company Name"></div></div><div data-direction="rtl" class="sidebar"><div><label class="visually-hidden">Email Address</label> <input type="email" name="email" autocomplete="email" placeholder="Email Address" required class="no-right-line"></div><button type="submit" data-button-variant="blue" class="button">Submit</button></div></div></form><div data-hubspot-message><div data-hubspot-success class="hidden">✅ Thank you for subscribing! Your email has been successfully submitted.</div><div data-hubspot-error class="hidden">❌ Something went wrong. Please try again later.</div><div data-hubspot-consent-error class="hidden">You must agree to the Privacy Policy before subscribing.</div></div></aside></div></div><div hidden class="h-entry"><a href="http://localhost:8080/blog/how-to-setup-data-platform-infrastructure-on-google-cloud-platform-with-terraform/" class="u-url">How to Setup Data Platform Infrastructure on Google Cloud Platform with Terraform</a> <a rel="author" href="http://localhost:8080" class="p-name u-url">The Scalable Way</a> <img src="http://localhost:8080/icon-512x512.png" alt="The Scalable Way" class="u-author h-card"></div></div></main><footer class="site-footer"><div class="wrapper"><div class="footer__meta | cluster"><nav aria-label="Complementary" class="footer__meta | cluster gutter-2xs text-step-0">© 2025 <a href="/subscribe/">Subscribe to Newsletter</a> <a href="/imprint/">Imprint</a> <a href="/privacy/">Privacy</a></nav><nav aria-label="Platforms" class="footer__meta | cluster gutter-4xs"><a href="/feed.xml" rel="alternate" type="application/atom+xml"><span class="visually-hidden">Atom Feed</span> <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true"><title>RSS</title><path d="M4 11a9 9 0 0 1 9 9M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg> </a><button data-consent-banner><svg width="1em" height="1em" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5M8.5 8.5v.01M16 15.5v.01M12 12v.01M11 17v.01M7 14v.01"></path></svg></button></nav></div><is-land on:idle><div role="region" aria-labelledby="theme-switcher-label" data-theme-switcher style="--cluster-horizontal-alignment: center; --gutter: 0.5rem" class="theme-switch | cluster mt-xs"><h2 id="theme-switcher-label">Theme</h2><button id="light-theme-toggle" data-theme="light" class="button"><span>light</span></button> <button id="dark-theme-toggle" data-theme="dark" class="button"><span>dark</span></button></div></is-land></div></footer><div id="consent-banner" hidden role="dialog" aria-modal="true" aria-labelledby="consent-title" aria-describedby="consent-description" class="consent flow"><h2 id="consent-title" class="visually-hidden">Cookie Consent</h2><p id="consent-description">We may load third-party embeds (e.g., calendar schedule). Please choose whether to enable these. Learn more in our <a href="/privacy">privacy policy</a>.</p><div class="consent-services flow"><div class="service-item repel gutter-2xs"><div><h3 class="text-step-min-1">HubSpot Calendar</h3><p class="text-step-min-1 text-gray">Meeting scheduling widget (collects IP, browser data)</p></div><div class="cluster gutter-2xs"><button type="button" data-service-decline="hubspot" data-small-button data-ghost-button-reverse class="button">Decline</button> <button type="button" data-service-accept="hubspot" data-ghost-button-reverse data-small-button class="button">Accept</button></div></div></div></div></body>
</html>